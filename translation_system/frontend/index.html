<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¸¸æˆæœ¬åœ°åŒ–ç¿»è¯‘ç³»ç»Ÿ</title>

  <!-- Element Plus CSS -->
  <link rel="stylesheet" href="https://unpkg.com/element-plus@2.4.4/dist/index.css">

  <!-- è‡ªå®šä¹‰CSS -->
  <style>
    :root {
      --primary-color: #2563eb;
      --primary-light: #3b82f6;
      --primary-dark: #1e40af;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --error-color: #ef4444;
      --info-color: #06b6d4;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-500: #6b7280;
      --gray-900: #111827;
      --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      --space-2: 0.5rem;
      --space-3: 0.75rem;
      --space-4: 1rem;
      --space-6: 1.5rem;
      --space-8: 2rem;
      --radius-md: 0.375rem;
      --radius-lg: 0.5rem;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --transition-fast: 150ms ease-in-out;
      --layout-sidebar-width: 240px;
      --layout-header-height: 64px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-sans);
      color: var(--gray-900);
      background-color: var(--gray-50);
      line-height: 1.5;
    }

    .app-layout {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    .sidebar {
      width: var(--layout-sidebar-width);
      background: white;
      border-right: 1px solid var(--gray-200);
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      height: var(--layout-header-height);
      display: flex;
      align-items: center;
      justify-content: center;
      border-bottom: 1px solid var(--gray-200);
      font-weight: 600;
      font-size: 1.125rem;
      color: var(--primary-color);
    }

    .sidebar-menu {
      flex: 1;
      padding: var(--space-4);
    }

    .menu-item {
      display: flex;
      align-items: center;
      padding: var(--space-3) var(--space-4);
      margin-bottom: var(--space-2);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition-fast);
      text-decoration: none;
      color: var(--gray-500);
    }

    .menu-item:hover {
      background: var(--gray-100);
      color: var(--gray-900);
    }

    .menu-item.active {
      background: var(--primary-color);
      color: white;
    }

    .menu-item .icon {
      margin-right: var(--space-3);
      font-size: 1.25rem;
    }

    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .header {
      height: var(--layout-header-height);
      background: white;
      border-bottom: 1px solid var(--gray-200);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 var(--space-6);
    }

    .page-content {
      flex: 1;
      padding: var(--space-6);
      overflow-y: auto;
    }

    .card {
      background: white;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--gray-200);
      overflow: hidden;
    }

    .card-header {
      padding: var(--space-6);
      border-bottom: 1px solid var(--gray-200);
      background: var(--gray-50);
    }

    .card-body {
      padding: var(--space-6);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      padding: var(--space-2) var(--space-4);
      border: none;
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-fast);
      text-decoration: none;
    }

    .btn-primary {
      background: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--gray-100);
      color: var(--gray-900);
    }

    .btn-secondary:hover {
      background: var(--gray-200);
    }

    .upload-area {
      border: 2px dashed var(--gray-200);
      border-radius: var(--radius-lg);
      padding: var(--space-8);
      text-align: center;
      transition: all var(--transition-fast);
      cursor: pointer;
    }

    .upload-area:hover {
      border-color: var(--primary-color);
      background: var(--gray-50);
    }

    .upload-area.dragover {
      border-color: var(--primary-color);
      background: #dbeafe;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--gray-200);
      border-radius: 4px;
      overflow: hidden;
      margin: var(--space-4) 0;
    }

    .progress-fill {
      height: 100%;
      background: var(--primary-color);
      transition: width 0.3s ease;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .status-success { background: #d1fae5; color: #065f46; }
    .status-warning { background: #fef3c7; color: #92400e; }
    .status-error { background: #fee2e2; color: #991b1b; }
    .status-info { background: #dbeafe; color: #1e40af; }

    .hidden { display: none; }
    .loading { opacity: 0.6; pointer-events: none; }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
      .app-layout {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        height: auto;
        order: 2;
      }

      .main-content {
        order: 1;
      }
    }

    /* åŠ¨ç”» */
    .fade-enter {
      opacity: 0;
      transform: translateY(20px);
    }

    .fade-enter-active {
      transition: all 0.3s ease;
    }

    .fade-enter-to {
      opacity: 1;
      transform: translateY(0);
    }

    /* è°ƒè¯•æ¨¡æ€æ¡†æ ·å¼ */
    .debug-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      background: rgba(0, 0, 0, 0.5);
      cursor: pointer;
    }

    .debug-modal.hidden {
      display: none;
    }

    .debug-modal-content {
      position: relative;
      background: white;
      border-radius: var(--radius-lg);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      max-width: 90%;
      max-height: 90%;
      width: 800px;
      display: flex;
      flex-direction: column;
      z-index: 1001;
      cursor: default;
    }

    .debug-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem;
      border-bottom: 1px solid var(--gray-200);
    }

    .debug-modal-header h3 {
      margin: 0;
      color: var(--gray-900);
    }

    .debug-close-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--gray-500);
      padding: 0.25rem;
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
    }

    .debug-close-btn:hover {
      background: var(--gray-100);
      color: var(--gray-900);
    }

    .debug-log-content {
      background: #1e293b;
      color: #e2e8f0;
      padding: 1rem;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 0.75rem;
      line-height: 1.4;
      white-space: pre-wrap;
      overflow-y: auto;
      max-height: 400px;
      margin: 1.5rem;
      border-radius: var(--radius-md);
      flex: 1;
    }

    .debug-modal-footer {
      display: flex;
      justify-content: center;
      gap: 1rem;
      padding: 1.5rem;
      border-top: 1px solid var(--gray-200);
    }

    /* å“åº”å¼è°ƒè¯•æ¨¡æ€æ¡† */
    @media (max-width: 768px) {
      .debug-modal {
        padding: 1rem;
      }

      .debug-modal-content {
        width: 100%;
        max-height: 95%;
      }

      .debug-log-content {
        max-height: 300px;
        font-size: 0.7rem;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="app-layout">
      <!-- ä¾§è¾¹æ  -->
      <div class="sidebar">
        <div class="sidebar-header">
          ğŸ® ç¿»è¯‘ç³»ç»Ÿ
        </div>
        <nav class="sidebar-menu">
          <a href="#dashboard" class="menu-item" data-page="dashboard">
            <span class="icon">ğŸ </span>
            <span>ä»ªè¡¨æ¿</span>
          </a>
          <a href="#quick-translation" class="menu-item" data-page="quick-translation">
            <span class="icon">ğŸ“</span>
            <span>å¿«é€Ÿç¿»è¯‘</span>
          </a>
          <a href="#project-management" class="menu-item" data-page="project-management">
            <span class="icon">ğŸ“Š</span>
            <span>é¡¹ç›®ç®¡ç†</span>
          </a>
          <a href="#task-center" class="menu-item" data-page="task-center">
            <span class="icon">ğŸ“‹</span>
            <span>ä»»åŠ¡ä¸­å¿ƒ</span>
          </a>
          <a href="#settings" class="menu-item" data-page="settings">
            <span class="icon">âš™ï¸</span>
            <span>ç³»ç»Ÿè®¾ç½®</span>
          </a>
        </nav>
      </div>

      <!-- ä¸»å†…å®¹åŒº -->
      <div class="main-content">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <header class="header">
          <div class="header-left">
            <h2 id="page-title">ä»ªè¡¨æ¿</h2>
          </div>
          <div class="header-right">
            <span class="status-badge" id="backend-status">ğŸ”— æ£€æµ‹ä¸­...</span>
            <button class="btn btn-secondary" onclick="toggleTheme()">ğŸŒ™</button>
            <button class="btn btn-secondary" onclick="showDebugLog()">ğŸ›</button>
          </div>
        </header>

        <!-- é¡µé¢å†…å®¹ -->
        <main class="page-content">
          <!-- ä»ªè¡¨æ¿é¡µé¢ -->
          <div id="dashboard-page" class="page">
            <div class="card">
              <div class="card-header">
                <h3>ğŸ® æ¸¸æˆæœ¬åœ°åŒ–ç¿»è¯‘ç³»ç»Ÿ</h3>
                <p>ä¸“ä¸šçš„å¤šè¯­è¨€ç¿»è¯‘è§£å†³æ–¹æ¡ˆ</p>
              </div>
              <div class="card-body">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                  <div class="card" style="text-align: center; padding: 2rem;">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">ğŸ“</div>
                    <h4>å¿«é€Ÿç¿»è¯‘</h4>
                    <p style="color: var(--gray-500); margin: 0.5rem 0;">ä¸Šä¼ Excelæ–‡ä»¶å¼€å§‹ç¿»è¯‘</p>
                    <button class="btn btn-primary" onclick="switchToPage('quick-translation')">å¼€å§‹ç¿»è¯‘</button>
                  </div>

                  <div class="card" style="text-align: center; padding: 2rem;">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">ğŸ“Š</div>
                    <h4>é¡¹ç›®ç®¡ç†</h4>
                    <p style="color: var(--gray-500); margin: 0.5rem 0;">ç®¡ç†ç¿»è¯‘é¡¹ç›®å’Œç‰ˆæœ¬</p>
                    <button class="btn btn-secondary" onclick="switchToPage('project-management')">ç®¡ç†é¡¹ç›®</button>
                  </div>

                  <div class="card" style="text-align: center; padding: 2rem;">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">ğŸ“‹</div>
                    <h4>ä»»åŠ¡ä¸­å¿ƒ</h4>
                    <p style="color: var(--gray-500); margin: 0.5rem 0;">æŸ¥çœ‹æ‰€æœ‰ç¿»è¯‘ä»»åŠ¡</p>
                    <button class="btn btn-secondary" onclick="switchToPage('task-center')">æŸ¥çœ‹ä»»åŠ¡</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- å¿«é€Ÿç¿»è¯‘é¡µé¢ -->
          <div id="quick-translation-page" class="page hidden">
            <div class="card">
              <div class="card-header">
                <h3>ğŸ“ å¿«é€Ÿç¿»è¯‘</h3>
                <p>ä¸Šä¼ Excelæ–‡ä»¶ï¼Œå¿«é€Ÿå®Œæˆå¤šè¯­è¨€ç¿»è¯‘</p>
              </div>
              <div class="card-body">
                <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
                <div style="display: flex; justify-content: center; margin-bottom: 2rem;">
                  <div class="steps">
                    <div class="step active" id="step-1">â‘ ä¸Šä¼ æ–‡ä»¶</div>
                    <div class="step" id="step-2">â‘¡é…ç½®å‚æ•°</div>
                    <div class="step" id="step-3">â‘¢å¼€å§‹ç¿»è¯‘</div>
                    <div class="step" id="step-4">â‘£ä¸‹è½½ç»“æœ</div>
                  </div>
                </div>

                <!-- ä¸Šä¼ åŒºåŸŸ -->
                <div id="upload-section">
                  <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“„</div>
                    <h3>æ‹–æ‹½Excelæ–‡ä»¶åˆ°æ­¤å¤„</h3>
                    <p style="color: var(--gray-500); margin: 1rem 0;">æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                    <button class="btn btn-primary">é€‰æ‹©æ–‡ä»¶</button>
                    <small style="display: block; margin-top: 1rem; color: var(--gray-500);">
                      æ”¯æŒ .xlsx, .xls æ ¼å¼ï¼Œæœ€å¤§ 10MB
                    </small>
                  </div>
                  <input type="file" id="fileInput" accept=".xlsx,.xls" style="display: none;">
                </div>

                <!-- é…ç½®åŒºåŸŸ -->
                <div id="config-section" class="hidden">
                  <h4>ç¿»è¯‘é…ç½®</h4>
                  <p style="color: var(--gray-500); margin-bottom: 1.5rem;">
                    ğŸ“‹ è¯·é…ç½®ç¿»è¯‘å‚æ•°ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æ£€æµ‹Excelæ–‡ä»¶ç»“æ„
                  </p>

                  <div style="margin: 1.5rem 0;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">ç›®æ ‡è¯­è¨€</label>
                    <p style="font-size: 0.875rem; color: var(--gray-500); margin-bottom: 1rem;">
                      ğŸ’¡ å¯é€‰æ‹©ç‰¹å®šè¯­è¨€ï¼Œæˆ–ä¸é€‰æ‹©è®©ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹æ‰€æœ‰éœ€è¦çš„è¯­è¨€
                    </p>
                    <div id="language-checkboxes" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem;">
                      <label><input type="checkbox" value="pt"> è‘¡è„ç‰™è¯­</label>
                      <label><input type="checkbox" value="th"> æ³°è¯­</label>
                      <label><input type="checkbox" value="ind"> å°å°¼è¯­</label>
                      <label><input type="checkbox" value="tw"> ç¹ä½“ä¸­æ–‡</label>
                      <label><input type="checkbox" value="vn"> è¶Šå—è¯­</label>
                      <label><input type="checkbox" value="es"> è¥¿ç­ç‰™è¯­</label>
                      <label><input type="checkbox" value="tr"> åœŸè€³å…¶è¯­</label>
                      <label><input type="checkbox" value="ja"> æ—¥è¯­</label>
                      <label><input type="checkbox" value="ko"> éŸ©è¯­</label>
                    </div>
                  </div>

                  <div style="margin: 1.5rem 0;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">åœ°åŒºä»£ç </label>
                    <select id="regionSelect" style="width: 100%; padding: 0.5rem; border: 1px solid var(--gray-200); border-radius: var(--radius-md);">
                      <option value="cn-hangzhou">ä¸­å›½æ­å·</option>
                      <option value="na">åŒ—ç¾</option>
                      <option value="sa">å—ç¾</option>
                      <option value="eu">æ¬§æ´²</option>
                      <option value="me">ä¸­ä¸œ</option>
                      <option value="as">äºšæ´²</option>
                    </select>
                  </div>

                  <div style="margin: 1.5rem 0;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">æ¸¸æˆèƒŒæ™¯</label>
                    <textarea id="gameBackground"
                      placeholder="è¯·æè¿°æ¸¸æˆç±»å‹ã€èƒŒæ™¯è®¾å®šç­‰ä¿¡æ¯ï¼Œæœ‰åŠ©äºæé«˜ç¿»è¯‘è´¨é‡"
                      style="width: 100%; padding: 0.5rem; border: 1px solid var(--gray-200); border-radius: var(--radius-md); min-height: 80px; resize: vertical;"></textarea>
                  </div>

                  <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn btn-secondary" onclick="backToUpload()">è¿”å›ä¸Šä¼ </button>
                    <button class="btn btn-primary" onclick="startTranslation()">å¼€å§‹ç¿»è¯‘</button>
                  </div>
                </div>

                <!-- è¿›åº¦åŒºåŸŸ -->
                <div id="progress-section" class="hidden">
                  <h4>ç¿»è¯‘è¿›åº¦</h4>

                  <div style="text-align: center;">
                    <div class="progress-bar">
                      <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <p id="progressText">å‡†å¤‡å¼€å§‹ç¿»è¯‘...</p>
                    <p id="progressDetails" style="color: var(--gray-500); font-size: 0.875rem;"></p>
                  </div>

                  <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn btn-secondary" onclick="cancelTranslation()" id="cancelBtn">å–æ¶ˆç¿»è¯‘</button>
                  </div>
                </div>

                <!-- ç»“æœåŒºåŸŸ -->
                <div id="result-section" class="hidden">
                  <div style="text-align: center;">
                    <div style="font-size: 4rem; color: var(--success-color); margin-bottom: 1rem;">âœ…</div>
                    <h3>ç¿»è¯‘å®Œæˆï¼</h3>
                    <p style="color: var(--gray-500); margin: 1rem 0;">æ‚¨çš„æ–‡ä»¶å·²ç»ç¿»è¯‘å®Œæˆï¼Œå¯ä»¥ä¸‹è½½äº†</p>

                    <div style="margin-top: 2rem;">
                      <button class="btn btn-primary" onclick="downloadResult()">ğŸ“¥ ä¸‹è½½ç»“æœ</button>
                      <button class="btn btn-secondary" onclick="startNewTranslation()">ğŸ”„ å¼€å§‹æ–°ç¿»è¯‘</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- å…¶ä»–é¡µé¢ï¼ˆå ä½ï¼‰ -->
          <div id="project-management-page" class="page hidden">
            <div class="card">
              <div class="card-body" style="text-align: center; padding: 4rem;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ“Š</div>
                <h3>é¡¹ç›®ç®¡ç†</h3>
                <p style="color: var(--gray-500);">åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…</p>
              </div>
            </div>
          </div>

          <div id="task-center-page" class="page hidden">
            <div class="card">
              <div class="card-body" style="text-align: center; padding: 4rem;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ“‹</div>
                <h3>ä»»åŠ¡ä¸­å¿ƒ</h3>
                <p style="color: var(--gray-500);">åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…</p>
              </div>
            </div>
          </div>

          <div id="settings-page" class="page hidden">
            <div class="card">
              <div class="card-body" style="text-align: center; padding: 4rem;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">âš™ï¸</div>
                <h3>ç³»ç»Ÿè®¾ç½®</h3>
                <p style="color: var(--gray-500);">åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…</p>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
  </div>

  <!-- è°ƒè¯•æ—¥å¿—æ¨¡æ€æ¡† -->
  <div id="debug-modal" class="debug-modal hidden" onclick="hideDebugLog()">
    <div class="debug-modal-content" onclick="event.stopPropagation()">
      <div class="debug-modal-header">
        <h3>ğŸ› è°ƒè¯•æ—¥å¿—</h3>
        <button class="debug-close-btn" onclick="hideDebugLog()">Ã—</button>
      </div>
      <div id="debug-log" class="debug-log-content"></div>
      <div class="debug-modal-footer">
        <button class="btn btn-secondary" onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
        <button class="btn btn-primary" onclick="hideDebugLog()">å…³é—­</button>
      </div>
    </div>
  </div>

  <script>
    console.log('ğŸš€ [ç³»ç»Ÿ] æ¸¸æˆæœ¬åœ°åŒ–ç¿»è¯‘ç³»ç»Ÿå¯åŠ¨...')

    // å…¨å±€å˜é‡
    let currentPage = 'dashboard'
    let selectedFile = null
    let currentTaskId = null
    let progressInterval = null
    const API_BASE = 'http://127.0.0.1:8101'

    // è°ƒè¯•æ—¥å¿—
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString()
      const icons = { info: 'â„¹ï¸', success: 'âœ…', error: 'âŒ', warning: 'âš ï¸' }
      const icon = icons[type] || 'â„¹ï¸'

      const logMessage = `[${timestamp}] ${icon} ${message}`
      const debugLogEl = document.getElementById('debug-log')
      if (debugLogEl) {
        debugLogEl.textContent += logMessage + '\n'
        debugLogEl.scrollTop = debugLogEl.scrollHeight
      }
      console.log(logMessage)
    }

    // é¡µé¢åˆ‡æ¢
    function switchToPage(pageName) {
      log(`ğŸ“„ åˆ‡æ¢åˆ°é¡µé¢: ${pageName}`)

      // éšè—æ‰€æœ‰é¡µé¢
      document.querySelectorAll('.page').forEach(page => {
        page.classList.add('hidden')
      })

      // æ˜¾ç¤ºç›®æ ‡é¡µé¢
      const targetPage = document.getElementById(`${pageName}-page`)
      if (targetPage) {
        targetPage.classList.remove('hidden')
      }

      // æ›´æ–°èœå•æ¿€æ´»çŠ¶æ€
      document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active')
      })
      document.querySelector(`[data-page="${pageName}"]`).classList.add('active')

      // æ›´æ–°é¡µé¢æ ‡é¢˜
      const titles = {
        'dashboard': 'ä»ªè¡¨æ¿',
        'quick-translation': 'å¿«é€Ÿç¿»è¯‘',
        'project-management': 'é¡¹ç›®ç®¡ç†',
        'task-center': 'ä»»åŠ¡ä¸­å¿ƒ',
        'settings': 'ç³»ç»Ÿè®¾ç½®'
      }
      document.getElementById('page-title').textContent = titles[pageName] || pageName
      currentPage = pageName
    }

    // åç«¯è¿æ¥æ£€æµ‹
    async function checkBackendStatus() {
      try {
        log('ğŸŒ æ£€æµ‹åç«¯æœåŠ¡è¿æ¥...')
        const response = await fetch(`${API_BASE}/api/health/ping`, {
          method: 'GET',
          headers: { 'Content-Type': 'application/json' }
        })

        if (response.ok) {
          const data = await response.json()
          log(`âœ… åç«¯è¿æ¥æˆåŠŸ: ${JSON.stringify(data)}`, 'success')
          document.getElementById('backend-status').innerHTML = 'ğŸŸ¢ åç«¯æ­£å¸¸'
          document.getElementById('backend-status').className = 'status-badge status-success'
          return true
        } else {
          throw new Error(`HTTP ${response.status}`)
        }
      } catch (error) {
        log(`âŒ åç«¯è¿æ¥å¤±è´¥: ${error.message}`, 'error')
        document.getElementById('backend-status').innerHTML = 'ğŸ”´ åç«¯ç¦»çº¿'
        document.getElementById('backend-status').className = 'status-badge status-error'
        return false
      }
    }

    // æ–‡ä»¶ä¸Šä¼ å¤„ç†
    function setupFileUpload() {
      const uploadArea = document.getElementById('uploadArea')
      const fileInput = document.getElementById('fileInput')

      // æ‹–æ‹½äº‹ä»¶
      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault()
        uploadArea.classList.add('dragover')
      })

      uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover')
      })

      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault()
        uploadArea.classList.remove('dragover')
        const files = e.dataTransfer.files
        if (files.length > 0) {
          handleFileSelect(files[0])
        }
      })

      // æ–‡ä»¶é€‰æ‹©
      fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
          handleFileSelect(e.target.files[0])
        }
      })
    }

    function handleFileSelect(file) {
      log(`ğŸ“ æ–‡ä»¶é€‰æ‹©: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)}MB)`)

      // éªŒè¯æ–‡ä»¶ç±»å‹
      if (!file.name.match(/\.(xlsx?|xls)$/i)) {
        log(`âŒ æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ: ${file.name}`, 'error')
        alert('åªæ”¯æŒExcelæ–‡ä»¶æ ¼å¼ (.xlsx, .xls)')
        return
      }

      // éªŒè¯æ–‡ä»¶å¤§å°
      if (file.size > 10 * 1024 * 1024) {
        log(`âŒ æ–‡ä»¶è¿‡å¤§: ${(file.size / 1024 / 1024).toFixed(2)}MB`, 'error')
        alert('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 10MB')
        return
      }

      selectedFile = file
      log(`âœ… æ–‡ä»¶éªŒè¯é€šè¿‡`, 'success')

      // æ›´æ–°ä¸Šä¼ åŒºåŸŸæ˜¾ç¤º
      uploadArea.innerHTML = `
        <div style="color: var(--success-color);">
          <div style="font-size: 3rem; margin-bottom: 1rem;">âœ…</div>
          <h3>æ–‡ä»¶å·²é€‰æ‹©</h3>
          <p><strong>${file.name}</strong></p>
          <p style="color: var(--gray-500);">å¤§å°: ${(file.size / 1024 / 1024).toFixed(2)}MB</p>
          <div style="margin-top: 1rem;">
            <button class="btn btn-primary" onclick="proceedToConfig()">â–¶ï¸ ç»§ç»­é…ç½®</button>
            <button class="btn btn-secondary" onclick="resetUpload()">ğŸ”„ é‡æ–°é€‰æ‹©</button>
          </div>
        </div>
      `

      // è·³è¿‡åˆ†æï¼Œç›´æ¥è¿›å…¥é…ç½®
      log('âš¡ è·³è¿‡æ–‡ä»¶åˆ†æï¼Œç›´æ¥è¿›å…¥é…ç½®é˜¶æ®µ')
      setTimeout(() => {
        document.getElementById('upload-section').classList.add('hidden')
        document.getElementById('config-section').classList.remove('hidden')
        setStep(2)
      }, 500)
    }

    async function analyzeFile() {
      if (!selectedFile) return

      log('ğŸ” å¼€å§‹åˆ†ææ–‡ä»¶ç»“æ„...')

      try {
        const formData = new FormData()
        formData.append('file', selectedFile)

        const response = await fetch(`${API_BASE}/api/translation/analyze`, {
          method: 'POST',
          body: formData
        })

        log(`ğŸ“Š åˆ†æAPIå“åº”çŠ¶æ€: ${response.status} ${response.statusText}`)

        if (response.ok) {
          // å…ˆè·å–å“åº”æ–‡æœ¬ï¼Œå†å°è¯•è§£æJSON
          const responseText = await response.text()
          log(`ğŸ“„ åŸå§‹å“åº”å†…å®¹: ${responseText}`)

          try {
            const data = JSON.parse(responseText)
            log(`âœ… æ–‡ä»¶åˆ†ææˆåŠŸ: ${JSON.stringify(data)}`, 'success')

            // æ˜¾ç¤ºé…ç½®åŒºåŸŸ
            document.getElementById('upload-section').classList.add('hidden')
            document.getElementById('config-section').classList.remove('hidden')
            setStep(2)

            // æ˜¾ç¤ºåˆ†æç»“æœ
            showAnalysisResult(data)
          } catch (jsonError) {
            log(`âŒ JSONè§£æå¤±è´¥: ${jsonError.message}`, 'error')
            log(`ğŸ” å“åº”å†…å®¹: ${responseText}`, 'error')
            alert('åç«¯è¿”å›çš„æ•°æ®æ ¼å¼æœ‰è¯¯ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡')
          }
        } else {
          // è·å–é”™è¯¯å“åº”å†…å®¹
          const errorText = await response.text()
          log(`âŒ APIè¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}`, 'error')
          log(`ğŸ” é”™è¯¯å“åº”: ${errorText}`, 'error')

          // å°è¯•è§£æé”™è¯¯ä¿¡æ¯
          try {
            const errorData = JSON.parse(errorText)
            if (errorData.message) {
              alert(`åˆ†æå¤±è´¥: ${errorData.message}`)
            } else {
              alert(`åˆ†æå¤±è´¥: HTTP ${response.status}`)
            }
          } catch {
            alert(`åˆ†æå¤±è´¥: HTTP ${response.status} - ${errorText}`)
          }
        }
      } catch (error) {
        log(`âŒ æ–‡ä»¶åˆ†æç½‘ç»œé”™è¯¯: ${error.message}`, 'error')
        log(`ğŸ” é”™è¯¯å †æ ˆ: ${error.stack}`, 'error')
        alert('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨')
      }
    }

    function proceedToConfig() {
      log('âš¡ ç›´æ¥è¿›å…¥é…ç½®é˜¶æ®µï¼Œè·³è¿‡æ–‡ä»¶åˆ†æ')
      document.getElementById('upload-section').classList.add('hidden')
      document.getElementById('config-section').classList.remove('hidden')
      setStep(2)

      // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯è€Œä¸æ˜¯åˆ†æç»“æœ
      showFileInfo()
    }

    function showFileInfo() {
      if (!selectedFile) return

      const configSection = document.getElementById('config-section')
      const fileInfoHtml = `
        <div style="background: var(--info-color); background: #e0f2fe; padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1.5rem; border-left: 4px solid var(--info-color);">
          <h5>ğŸ“ å·²é€‰æ‹©æ–‡ä»¶</h5>
          <p><strong>æ–‡ä»¶å:</strong> ${selectedFile.name}</p>
          <p><strong>æ–‡ä»¶å¤§å°:</strong> ${(selectedFile.size / 1024 / 1024).toFixed(2)}MB</p>
          <p><strong>æ–‡ä»¶ç±»å‹:</strong> ${selectedFile.name.split('.').pop().toUpperCase()} æ ¼å¼</p>
          <p style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--gray-600);">
            ğŸ’¡ ç³»ç»Ÿå°†è‡ªåŠ¨æ£€æµ‹æ–‡ä»¶ç»“æ„å¹¶å¼€å§‹ç¿»è¯‘
          </p>
        </div>
      `
      configSection.insertAdjacentHTML('afterbegin', fileInfoHtml)
    }

    async function startTranslation() {
      if (!selectedFile) return

      log('ğŸš€ å¼€å§‹ç¿»è¯‘ä»»åŠ¡...')

      // æ”¶é›†é…ç½®
      const checkedLanguages = Array.from(document.querySelectorAll('#language-checkboxes input[type="checkbox"]:checked'))
        .map(cb => cb.value)

      // å…è®¸ä¸é€‰æ‹©è¯­è¨€ï¼Œè®©åç«¯è‡ªåŠ¨æ£€æµ‹
      if (checkedLanguages.length === 0) {
        log('ğŸ¤– æœªé€‰æ‹©ç›®æ ‡è¯­è¨€ï¼Œå°†ä½¿ç”¨è‡ªåŠ¨æ£€æµ‹æ¨¡å¼')
      } else {
        log(`ğŸ¯ å·²é€‰æ‹©ç›®æ ‡è¯­è¨€: ${checkedLanguages.join(', ')}`)
      }

      const config = {
        batch_size: 10,
        max_concurrent: 20,
        region_code: document.getElementById('regionSelect').value,
        auto_detect: 'true'  // å­—ç¬¦ä¸²æ ¼å¼ï¼Œå’Œè„šæœ¬ä¿æŒä¸€è‡´
      }

      // åªæœ‰é€‰æ‹©äº†è¯­è¨€æ‰æ·»åŠ target_languageså‚æ•°
      if (checkedLanguages.length > 0) {
        config.target_languages = checkedLanguages.join(',')
      }

      // åªæœ‰å¡«å†™äº†æ¸¸æˆèƒŒæ™¯æ‰æ·»åŠ 
      const gameBackground = document.getElementById('gameBackground').value.trim()
      if (gameBackground) {
        config.game_background = gameBackground
      }

      log(`âš™ï¸ ç¿»è¯‘é…ç½®: ${JSON.stringify(config)}`)

      try {
        const formData = new FormData()
        formData.append('file', selectedFile)
        Object.entries(config).forEach(([key, value]) => {
          if (value) formData.append(key, value)
        })

        const response = await fetch(`${API_BASE}/api/translation/upload`, {
          method: 'POST',
          body: formData
        })

        log(`ğŸ“Š ä¸Šä¼ APIå“åº”çŠ¶æ€: ${response.status} ${response.statusText}`)

        if (response.ok) {
          // å…ˆè·å–å“åº”æ–‡æœ¬ï¼Œå†å°è¯•è§£æJSON
          const responseText = await response.text()
          log(`ğŸ“„ ä¸Šä¼ å“åº”å†…å®¹: ${responseText}`)

          try {
            const data = JSON.parse(responseText)
            currentTaskId = data.task_id
            log(`âœ… ç¿»è¯‘ä»»åŠ¡åˆ›å»ºæˆåŠŸ: ${currentTaskId}`, 'success')

            // åˆ‡æ¢åˆ°è¿›åº¦é¡µé¢
            document.getElementById('config-section').classList.add('hidden')
            document.getElementById('progress-section').classList.remove('hidden')
            setStep(3)

            // å¼€å§‹ç›‘æ§è¿›åº¦
            startProgressMonitoring()
          } catch (jsonError) {
            log(`âŒ ä¸Šä¼ å“åº”JSONè§£æå¤±è´¥: ${jsonError.message}`, 'error')
            log(`ğŸ” å“åº”å†…å®¹: ${responseText}`, 'error')
            alert('åç«¯è¿”å›çš„æ•°æ®æ ¼å¼æœ‰è¯¯')
          }
        } else {
          // è·å–é”™è¯¯å“åº”å†…å®¹
          const errorText = await response.text()
          log(`âŒ ä¸Šä¼ APIè¯·æ±‚å¤±è´¥: ${response.status}`, 'error')
          log(`ğŸ” é”™è¯¯å“åº”: ${errorText}`, 'error')

          try {
            const errorData = JSON.parse(errorText)
            alert(`ä¸Šä¼ å¤±è´¥: ${errorData.message || errorData.error || 'æœªçŸ¥é”™è¯¯'}`)
          } catch {
            alert(`ä¸Šä¼ å¤±è´¥: HTTP ${response.status}`)
          }
        }
      } catch (error) {
        log(`âŒ ç¿»è¯‘å¯åŠ¨å¤±è´¥: ${error.message}`, 'error')
        alert('ç¿»è¯‘å¯åŠ¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡')
      }
    }

    function startProgressMonitoring() {
      if (!currentTaskId) return

      log('ğŸ“Š å¼€å§‹ç›‘æ§ç¿»è¯‘è¿›åº¦...')

      progressInterval = setInterval(async () => {
        try {
          const response = await fetch(`${API_BASE}/api/translation/tasks/${currentTaskId}/progress`)

          if (response.ok) {
            const data = await response.json()
            updateProgress(data)

            if (['completed', 'failed', 'cancelled'].includes(data.status)) {
              clearInterval(progressInterval)

              if (data.status === 'completed') {
                showResult()
              } else {
                log(`âŒ ç¿»è¯‘ä»»åŠ¡${data.status}: ${data.error_message || ''}`, 'error')
                alert(`ç¿»è¯‘ä»»åŠ¡${data.status}`)
                resetTranslation()
              }
            }
          } else {
            log(`âš ï¸ è¿›åº¦æŸ¥è¯¢å¤±è´¥: HTTP ${response.status}`, 'warning')
          }
        } catch (error) {
          log(`âŒ è¿›åº¦ç›‘æ§é”™è¯¯: ${error.message}`, 'error')
        }
      }, 2000)
    }

    function updateProgress(data) {
      const percentage = data.progress.completion_percentage || 0
      document.getElementById('progressFill').style.width = `${percentage}%`
      document.getElementById('progressText').textContent = `ç¿»è¯‘è¿›åº¦: ${percentage.toFixed(1)}%`

      const details = `å·²å®Œæˆ: ${data.progress.translated_rows}/${data.progress.total_rows} | å½“å‰Sheet: ${data.current_sheet || 'æœªçŸ¥'}`
      document.getElementById('progressDetails').textContent = details

      log(`ğŸ“Š è¿›åº¦æ›´æ–°: ${percentage.toFixed(1)}% - ${details}`)
    }

    function showResult() {
      log('ğŸ‰ ç¿»è¯‘ä»»åŠ¡å®Œæˆï¼', 'success')
      document.getElementById('progress-section').classList.add('hidden')
      document.getElementById('result-section').classList.remove('hidden')
      setStep(4)
    }

    async function downloadResult() {
      if (!currentTaskId) return

      log('ğŸ“¥ å¼€å§‹ä¸‹è½½ç¿»è¯‘ç»“æœ...')

      try {
        const link = document.createElement('a')
        link.href = `${API_BASE}/api/translation/tasks/${currentTaskId}/download`
        link.download = 'translated_result.xlsx'
        document.body.appendChild(link)
        link.click()
        document.body.removeChild(link)

        log('âœ… ä¸‹è½½é“¾æ¥å·²è§¦å‘', 'success')
      } catch (error) {
        log(`âŒ ä¸‹è½½å¤±è´¥: ${error.message}`, 'error')
        alert('ä¸‹è½½å¤±è´¥')
      }
    }

    function cancelTranslation() {
      if (progressInterval) {
        clearInterval(progressInterval)
      }

      if (currentTaskId) {
        fetch(`${API_BASE}/api/translation/tasks/${currentTaskId}`, { method: 'DELETE' })
          .then(() => log('ğŸš« ç¿»è¯‘ä»»åŠ¡å·²å–æ¶ˆ', 'warning'))
          .catch(error => log(`âŒ å–æ¶ˆä»»åŠ¡å¤±è´¥: ${error.message}`, 'error'))
      }

      resetTranslation()
    }

    function resetTranslation() {
      document.getElementById('progress-section').classList.add('hidden')
      document.getElementById('result-section').classList.add('hidden')
      document.getElementById('upload-section').classList.remove('hidden')
      resetUpload()
      setStep(1)
    }

    function startNewTranslation() {
      resetTranslation()
    }

    function resetUpload() {
      selectedFile = null
      currentTaskId = null

      document.getElementById('uploadArea').innerHTML = `
        <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“„</div>
        <h3>æ‹–æ‹½Excelæ–‡ä»¶åˆ°æ­¤å¤„</h3>
        <p style="color: var(--gray-500); margin: 1rem 0;">æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
        <button class="btn btn-primary">é€‰æ‹©æ–‡ä»¶</button>
        <small style="display: block; margin-top: 1rem; color: var(--gray-500);">
          æ”¯æŒ .xlsx, .xls æ ¼å¼ï¼Œæœ€å¤§ 10MB
        </small>
      `

      document.getElementById('fileInput').value = ''
      log('ğŸ”„ ä¸Šä¼ åŒºåŸŸå·²é‡ç½®')
    }

    function backToUpload() {
      document.getElementById('config-section').classList.add('hidden')
      document.getElementById('upload-section').classList.remove('hidden')
      setStep(1)
    }

    function setStep(stepNumber) {
      document.querySelectorAll('.step').forEach((step, index) => {
        step.classList.remove('active', 'completed')
        if (index + 1 < stepNumber) {
          step.classList.add('completed')
        } else if (index + 1 === stepNumber) {
          step.classList.add('active')
        }
      })
    }

    function showDebugLog() {
      log('ğŸ› æ‰“å¼€è°ƒè¯•æ—¥å¿—çª—å£')
      const modal = document.getElementById('debug-modal')
      modal.classList.remove('hidden')

      // èšç„¦åˆ°æ¨¡æ€æ¡†ä»¥æ”¯æŒé”®ç›˜äº‹ä»¶
      modal.focus()
    }

    function hideDebugLog() {
      log('âŒ å…³é—­è°ƒè¯•æ—¥å¿—çª—å£')
      const modal = document.getElementById('debug-modal')
      modal.classList.add('hidden')
    }

    function clearLog() {
      document.getElementById('debug-log').textContent = ''
      log('ğŸ§¹ æ—¥å¿—å·²æ¸…é™¤')
    }

    function toggleTheme() {
      document.body.classList.toggle('dark')
      log('ğŸŒ™ ä¸»é¢˜å·²åˆ‡æ¢')
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      log('ğŸ‰ ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ')
      log('ğŸ“ å½“å‰é¡µé¢: ' + window.location.href)

      // è®¾ç½®èœå•ç‚¹å‡»äº‹ä»¶
      document.querySelectorAll('.menu-item').forEach(item => {
        item.addEventListener('click', (e) => {
          e.preventDefault()
          const pageName = item.getAttribute('data-page')
          switchToPage(pageName)
        })
      })

      // åˆå§‹åŒ–æ–‡ä»¶ä¸Šä¼ 
      setupFileUpload()

      // æ£€æµ‹åç«¯çŠ¶æ€
      checkBackendStatus()

      // è®¾ç½®é»˜è®¤é¡µé¢
      switchToPage('dashboard')

      log('ğŸš€ ç³»ç»Ÿå°±ç»ªï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨ï¼', 'success')
    })

    // é”®ç›˜äº‹ä»¶ç›‘å¬
    document.addEventListener('keydown', (e) => {
      // ESCé”®å…³é—­è°ƒè¯•çª—å£
      if (e.key === 'Escape') {
        const modal = document.getElementById('debug-modal')
        if (!modal.classList.contains('hidden')) {
          hideDebugLog()
        }
      }
    })

    // é”™è¯¯ç›‘å¬
    window.addEventListener('error', (e) => {
      log(`ğŸ’¥ JavaScripté”™è¯¯: ${e.message} at ${e.filename}:${e.lineno}`, 'error')
    })

    window.addEventListener('unhandledrejection', (e) => {
      log(`ğŸ’¥ æœªå¤„ç†çš„Promiseé”™è¯¯: ${e.reason}`, 'error')
    })
  </script>

  <style>
    .steps {
      display: flex;
      align-items: center;
      gap: 2rem;
    }

    .step {
      padding: 0.5rem 1rem;
      border-radius: var(--radius-md);
      background: var(--gray-100);
      color: var(--gray-500);
      font-weight: 500;
      transition: all var(--transition-fast);
    }

    .step.active {
      background: var(--primary-color);
      color: white;
    }

    .step.completed {
      background: var(--success-color);
      color: white;
    }

    .step:not(:last-child)::after {
      content: 'â†’';
      margin-left: 1rem;
      color: var(--gray-400);
    }
  </style>
</body>
</html>