# Translation System Frontend V2 - React 18 实施方案

## 🎯 技术选型（确定方案）

**核心技术栈：纯 React 18 + Vite + TypeScript**

```json
{
  "framework": "React 18.2",
  "bundler": "Vite 5.0",
  "language": "TypeScript 5.0",
  "routing": "React Router 6.20",
  "state": "Zustand 4.4",
  "ui": "Ant Design 5.12",
  "http": "Axios 1.6",
  "websocket": "Native WebSocket",
  "charts": "Recharts 2.10",
  "excel": "SheetJS (xlsx)",
  "styles": "CSS Modules + Tailwind CSS"
}
```

## 📁 项目结构（模块化设计）

```
frontend_v2/
├── src/
│   ├── modules/                # 业务模块（核心）
│   │   ├── upload/             # 上传模块
│   │   │   ├── api.ts          # API接口
│   │   │   ├── store.ts        # 状态管理
│   │   │   ├── hooks.ts        # 业务逻辑
│   │   │   ├── components/     # 模块组件
│   │   │   │   ├── UploadPanel.tsx
│   │   │   │   ├── FilePreview.tsx
│   │   │   │   └── UploadProgress.tsx
│   │   │   ├── types.ts        # 类型定义
│   │   │   └── index.ts        # 模块导出
│   │   │
│   │   ├── analysis/           # 分析模块
│   │   │   ├── api.ts
│   │   │   ├── store.ts
│   │   │   ├── hooks.ts
│   │   │   ├── components/
│   │   │   └── index.ts
│   │   │
│   │   ├── translation/        # 翻译执行模块
│   │   │   ├── api.ts
│   │   │   ├── store.ts
│   │   │   ├── hooks.ts
│   │   │   ├── components/
│   │   │   └── index.ts
│   │   │
│   │   ├── monitor/            # 监控模块
│   │   │   └── ...
│   │   │
│   │   └── export/             # 导出模块
│   │       └── ...
│   │
│   ├── shared/                 # 共享资源
│   │   ├── components/         # 通用组件
│   │   │   ├── Layout/
│   │   │   ├── Loading/
│   │   │   └── ErrorBoundary/
│   │   ├── hooks/              # 通用Hooks
│   │   │   ├── useWebSocket.ts
│   │   │   ├── useNotification.ts
│   │   │   └── useDebounce.ts
│   │   ├── utils/              # 工具函数
│   │   │   ├── format.ts
│   │   │   ├── validate.ts
│   │   │   └── storage.ts
│   │   └── types/              # 全局类型
│   │       ├── api.types.ts
│   │       └── common.types.ts
│   │
│   ├── core/                   # 核心配置
│   │   ├── api/                # API配置
│   │   │   ├── client.ts       # Axios实例
│   │   │   ├── interceptors.ts # 拦截器
│   │   │   └── config.ts       # API配置
│   │   ├── router/             # 路由配置
│   │   │   └── index.tsx
│   │   └── constants/          # 常量定义
│   │       └── index.ts
│   │
│   ├── pages/                  # 页面组件
│   │   ├── HomePage.tsx
│   │   ├── UploadPage.tsx
│   │   ├── AnalysisPage.tsx
│   │   ├── TranslationPage.tsx
│   │   ├── MonitorPage.tsx
│   │   └── ExportPage.tsx
│   │
│   ├── styles/                 # 全局样式
│   │   ├── global.css
│   │   ├── variables.css
│   │   └── tailwind.css
│   │
│   ├── App.tsx                 # 根组件
│   ├── main.tsx                # 入口文件
│   └── vite-env.d.ts          # Vite类型声明
│
├── public/                     # 静态资源
│   └── favicon.ico
│
├── tests/                      # 测试文件
│   ├── unit/                   # 单元测试
│   └── e2e/                    # 端到端测试
│
├── .gitignore
├── package.json
├── tsconfig.json
├── vite.config.ts
├── tailwind.config.js
└── README.md
```

## 🚀 快速启动

### 1. 初始化项目（30秒）
```bash
# 创建项目
npm create vite@latest . -- --template react-ts

# 安装核心依赖
npm install axios zustand react-router-dom antd @ant-design/icons

# 安装开发依赖
npm install -D @types/node tailwindcss postcss autoprefixer

# 初始化Tailwind
npx tailwindcss init -p
```

### 2. 配置文件

**vite.config.ts**
```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true
      },
      '/ws': {
        target: 'ws://localhost:8000',
        ws: true
      }
    }
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
      '@modules': path.resolve(__dirname, './src/modules'),
      '@shared': path.resolve(__dirname, './src/shared'),
      '@core': path.resolve(__dirname, './src/core'),
      '@pages': path.resolve(__dirname, './src/pages')
    }
  }
})
```

**tsconfig.json**
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "paths": {
      "@/*": ["./src/*"],
      "@modules/*": ["./src/modules/*"],
      "@shared/*": ["./src/shared/*"],
      "@core/*": ["./src/core/*"],
      "@pages/*": ["./src/pages/*"]
    }
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

## 📝 开发规范

### 1. 模块化原则
- 每个模块完全独立，包含自己的 api、store、hooks、components
- 模块间通过事件或公共store通信，避免直接引用
- 模块对外只暴露必要的接口（通过index.ts）

### 2. 命名规范
- 组件：PascalCase（如 `UploadPanel.tsx`）
- 工具函数：camelCase（如 `formatDate.ts`）
- 常量：UPPER_SNAKE_CASE（如 `API_BASE_URL`）
- 类型：PascalCase + 后缀（如 `UploadConfig.type.ts`）

### 3. 状态管理规范
- 局部状态：使用 useState
- 模块状态：使用模块内的 Zustand store
- 全局状态：使用 shared store（尽量避免）

### 4. API调用规范
```typescript
// 统一的API调用模式
export const uploadApi = {
  upload: (file: File) =>
    apiClient.post<UploadResponse>('/api/upload', file),

  getStatus: (sessionId: string) =>
    apiClient.get<SessionStatus>(`/api/sessions/${sessionId}`)
}
```

## 🎯 开发阶段（15天完成）

### 第一阶段：基础架构（2天）
- [ ] 项目初始化和配置
- [ ] 路由系统搭建
- [ ] API客户端配置
- [ ] 基础布局组件

### 第二阶段：核心功能（5天）
- [ ] 上传模块
- [ ] 分析模块
- [ ] 任务拆分模块
- [ ] 翻译执行模块

### 第三阶段：实时功能（3天）
- [ ] WebSocket连接
- [ ] 实时进度展示
- [ ] 监控面板

### 第四阶段：完善功能（3天）
- [ ] 结果展示
- [ ] 导出下载
- [ ] 错误处理

### 第五阶段：优化测试（2天）
- [ ] 性能优化
- [ ] 单元测试
- [ ] 集成测试

## 🔧 核心模块示例

### Upload模块完整实现

**modules/upload/types.ts**
```typescript
export interface UploadState {
  file: File | null
  sessionId: string | null
  uploading: boolean
  progress: number
  error: string | null
}

export interface UploadResponse {
  session_id: string
  filename: string
  status: string
}
```

**modules/upload/api.ts**
```typescript
import { apiClient } from '@core/api/client'
import type { UploadResponse } from './types'

export const uploadApi = {
  upload: async (file: File): Promise<UploadResponse> => {
    const formData = new FormData()
    formData.append('file', file)
    return apiClient.post('/api/upload', formData)
  }
}
```

**modules/upload/store.ts**
```typescript
import { create } from 'zustand'
import { uploadApi } from './api'
import type { UploadState } from './types'

export const useUploadStore = create<UploadState & {
  upload: (file: File) => Promise<void>
  reset: () => void
}>((set) => ({
  file: null,
  sessionId: null,
  uploading: false,
  progress: 0,
  error: null,

  upload: async (file: File) => {
    set({ uploading: true, progress: 0, error: null, file })

    try {
      const response = await uploadApi.upload(file)
      set({
        sessionId: response.session_id,
        uploading: false,
        progress: 100
      })
    } catch (error) {
      set({
        error: error.message,
        uploading: false
      })
    }
  },

  reset: () => set({
    file: null,
    sessionId: null,
    uploading: false,
    progress: 0,
    error: null
  })
}))
```

**modules/upload/components/UploadPanel.tsx**
```tsx
import React from 'react'
import { Upload, Button, Progress, message } from 'antd'
import { UploadOutlined } from '@ant-design/icons'
import { useUploadStore } from '../store'

export const UploadPanel: React.FC = () => {
  const { upload, uploading, progress, error } = useUploadStore()

  const handleBeforeUpload = (file: File) => {
    const isExcel = file.type === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
      || file.type === 'application/vnd.ms-excel'

    if (!isExcel) {
      message.error('只能上传Excel文件!')
      return false
    }

    const isLt10M = file.size / 1024 / 1024 < 10
    if (!isLt10M) {
      message.error('文件大小不能超过10MB!')
      return false
    }

    upload(file)
    return false
  }

  return (
    <div className="upload-panel p-6 bg-white rounded-lg shadow">
      <Upload
        beforeUpload={handleBeforeUpload}
        showUploadList={false}
        disabled={uploading}
      >
        <Button
          icon={<UploadOutlined />}
          loading={uploading}
          size="large"
        >
          {uploading ? '上传中...' : '选择Excel文件'}
        </Button>
      </Upload>

      {uploading && (
        <Progress
          percent={progress}
          status="active"
          className="mt-4"
        />
      )}

      {error && (
        <div className="mt-4 text-red-500">
          错误: {error}
        </div>
      )}
    </div>
  )
}
```

**modules/upload/index.ts**
```typescript
// 模块统一导出
export { UploadPanel } from './components/UploadPanel'
export { useUploadStore } from './store'
export type { UploadState, UploadResponse } from './types'
```

## 🎨 UI设计原则

1. **简洁清晰**：功能明确，操作直观
2. **响应式反馈**：所有操作都有即时反馈
3. **错误友好**：错误信息清晰，提供解决方案
4. **性能优先**：大数据量时使用虚拟滚动

## ⚡ 性能优化策略

1. **代码分割**：路由级别的懒加载
2. **状态优化**：使用Zustand的浅比较
3. **组件优化**：React.memo和useMemo
4. **请求优化**：请求缓存和防抖
5. **打包优化**：Tree-shaking和按需加载

## 🧪 测试策略

1. **单元测试**：测试工具函数和hooks
2. **组件测试**：测试UI组件交互
3. **集成测试**：测试模块间协作
4. **E2E测试**：测试完整业务流程

## 📦 部署方案

```bash
# 构建生产版本
npm run build

# 预览生产版本
npm run preview

# 部署到服务器（静态文件）
scp -r dist/* user@server:/var/www/translation-frontend/
```

## 🎯 项目里程碑

- **第3天**：完成基础架构，可以上传文件
- **第7天**：完成核心功能，可以执行翻译
- **第10天**：完成实时功能，可以看到进度
- **第13天**：完成所有功能，可以导出结果
- **第15天**：完成测试优化，准备上线

## 📚 参考资源

- [React 18 文档](https://react.dev/)
- [Vite 文档](https://vitejs.dev/)
- [Zustand 文档](https://github.com/pmndrs/zustand)
- [Ant Design 文档](https://ant.design/)
- [React Router 文档](https://reactrouter.com/)