# é¡µé¢è®¾è®¡ï¼šç»“æœå¯¼å‡ºé¡µ

> **é¡µé¢è·¯å¾„**: `#/complete/:sessionId`
> **åç«¯API**: `/api/download/*`, `/api/monitor/summary/*`
> **è®¾è®¡åŸºäº**: download_api.py, monitor_api.py

---

## 1. é¡µé¢æ¦‚è¿°

### 1.1 æ ¸å¿ƒåŠŸèƒ½
åŸºäºåç«¯å®é™…èƒ½åŠ›ï¼Œæ­¤é¡µé¢è´Ÿè´£ï¼š
- å±•ç¤ºç¿»è¯‘å®Œæˆç»Ÿè®¡
- é¢„è§ˆç¿»è¯‘ç»“æœè´¨é‡
- ä¸‹è½½ç¿»è¯‘åçš„Excelæ–‡ä»¶
- æä¾›é‡æ–°ç¿»è¯‘å…¥å£

### 1.2 ç”¨æˆ·ä»·å€¼
- **æˆæœè·å–**: å¿«é€Ÿä¸‹è½½ç¿»è¯‘ç»“æœ
- **è´¨é‡ç¡®è®¤**: äº†è§£ç¿»è¯‘è´¨é‡æŒ‡æ ‡
- **å†³ç­–æ”¯æŒ**: åˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°ç¿»è¯‘
- **ä»»åŠ¡é—­ç¯**: å®Œæˆæ•´ä¸ªç¿»è¯‘æµç¨‹

---

## 2. åŠŸèƒ½è®¾è®¡

### 2.1 ç»“æœä¸‹è½½

#### APIèƒ½åŠ›ï¼ˆåŸºäºdownload_api.pyï¼‰
```python
# GET /api/download/{session_id}
# è¿”å›ï¼šExcelæ–‡ä»¶æµ
# ç‰¹æ€§ï¼š
# - æ”¯æŒæ–­ç‚¹ç»­ä¼ 
# - è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶å
# - ä¿ç•™åŸå§‹æ ¼å¼
```

### 2.2 å®Œæˆç»Ÿè®¡

#### APIèƒ½åŠ›ï¼ˆåŸºäºmonitor_api.pyï¼‰
```python
# GET /api/monitor/summary/{session_id}
{
  "summary": {
    "total_tasks": 856,
    "completed": 854,
    "failed": 2,
    "success_rate": 99.77,
    "total_time": 305,        # ç§’
    "average_confidence": 94.5
  },
  "language_stats": {
    "ZH": {"count": 428, "avg_confidence": 95.2},
    "EN": {"count": 428, "avg_confidence": 93.8}
  },
  "quality_distribution": {
    "high": 750,      # ç½®ä¿¡åº¦ > 90%
    "medium": 100,    # ç½®ä¿¡åº¦ 70-90%
    "low": 4          # ç½®ä¿¡åº¦ < 70%
  }
}
```

---

## 3. ç•Œé¢å¸ƒå±€

### 3.1 é¡µé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ä¼šè¯å‰©ä½™: 6:45] âš ï¸è¯·å°½å¿«ä¸‹è½½                  â”‚
â”‚              ç¿»è¯‘å®Œæˆ                           â”‚
â”‚         æ‚¨çš„ç¿»è¯‘ä»»åŠ¡å·²å®Œæˆï¼                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         âœ… ç¿»è¯‘æˆåŠŸå®Œæˆ                  â”‚    â”‚
â”‚  â”‚                                          â”‚    â”‚
â”‚  â”‚      æ–‡ä»¶: translations.xlsx             â”‚    â”‚
â”‚  â”‚      è€—æ—¶: 5åˆ†05ç§’                       â”‚    â”‚
â”‚  â”‚      å®Œæˆç‡: 99.77%                      â”‚    â”‚
â”‚  â”‚                                          â”‚    â”‚
â”‚  â”‚    [ğŸ“¥ ä¸‹è½½ç»“æœ] (ä¸»æŒ‰é’®)                â”‚    â”‚
â”‚  â”‚                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  è´¨é‡æ¦‚è§ˆ                                â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                          â”‚    â”‚
â”‚  â”‚  æ•´ä½“ç½®ä¿¡åº¦:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘  94.5%       â”‚    â”‚
â”‚  â”‚                                          â”‚    â”‚
â”‚  â”‚  è´¨é‡åˆ†å¸ƒ:                               â”‚    â”‚
â”‚  â”‚  ğŸŸ¢ é«˜è´¨é‡ (>90%):  750 ä¸ª (87.6%)      â”‚    â”‚
â”‚  â”‚  ğŸŸ¡ ä¸­ç­‰è´¨é‡:       100 ä¸ª (11.7%)      â”‚    â”‚
â”‚  â”‚  ğŸ”´ ä½è´¨é‡:           4 ä¸ª (0.5%)       â”‚    â”‚
â”‚  â”‚  âš« å¤±è´¥:             2 ä¸ª (0.2%)       â”‚    â”‚
â”‚  â”‚                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  è¯­è¨€ç»Ÿè®¡         â”‚   æ€§èƒ½æŒ‡æ ‡           â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                   â”‚                     â”‚    â”‚
â”‚  â”‚ ä¸­æ–‡ç¿»è¯‘:         â”‚ æ€»ä»»åŠ¡: 856         â”‚    â”‚
â”‚  â”‚   æ•°é‡: 428       â”‚ æˆåŠŸ: 854           â”‚    â”‚
â”‚  â”‚   ç½®ä¿¡åº¦: 95.2%   â”‚ å¤±è´¥: 2             â”‚    â”‚
â”‚  â”‚                   â”‚                     â”‚    â”‚
â”‚  â”‚ è‹±æ–‡ç¿»è¯‘:         â”‚ æ€»è€—æ—¶: 5:05        â”‚    â”‚
â”‚  â”‚   æ•°é‡: 428       â”‚ å¹³å‡é€Ÿåº¦: 2.8/ç§’    â”‚    â”‚
â”‚  â”‚   ç½®ä¿¡åº¦: 93.8%   â”‚ Tokenç”¨é‡: 156K     â”‚    â”‚
â”‚  â”‚                   â”‚                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  å¤±è´¥ä»»åŠ¡ (2ä¸ª)                          â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                          â”‚    â”‚
â”‚  â”‚  âŒ Task #234                            â”‚    â”‚
â”‚  â”‚     åŸæ–‡: "Complex technical term..."    â”‚    â”‚
â”‚  â”‚     åŸå› : APIè¶…æ—¶                        â”‚    â”‚
â”‚  â”‚                                          â”‚    â”‚
â”‚  â”‚  âŒ Task #567                            â”‚    â”‚
â”‚  â”‚     åŸæ–‡: "Very long paragraph..."       â”‚    â”‚
â”‚  â”‚     åŸå› : Tokenè¶…é™                      â”‚    â”‚
â”‚  â”‚                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  åç»­æ“ä½œ                                â”‚    â”‚
â”‚  â”‚                                          â”‚    â”‚
â”‚  â”‚  [é‡æ–°ç¿»è¯‘å¤±è´¥ä»»åŠ¡]  [å¼€å§‹æ–°é¡¹ç›®]        â”‚    â”‚
â”‚  â”‚                                          â”‚    â”‚
â”‚  â”‚  [æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š]  [å¯¼å‡ºæ—¥å¿—]              â”‚    â”‚
â”‚  â”‚                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å“åº”å¼è®¾è®¡

#### æ¡Œé¢ç«¯ (â‰¥1024px)
- å±…ä¸­å¡ç‰‡å¸ƒå±€ï¼Œæœ€å¤§å®½åº¦900px
- ç»Ÿè®¡æ•°æ®å¹¶æ’æ˜¾ç¤º
- è¯¦ç»†ä¿¡æ¯å®Œå…¨å±•å¼€

#### å¹³æ¿ç«¯ (768px-1023px)
- å…¨å®½å¡ç‰‡ï¼Œç•™è¾¹è·
- ç»Ÿè®¡æ•°æ®2åˆ—å¸ƒå±€
- å¤±è´¥ä»»åŠ¡æŠ˜å æ˜¾ç¤º

#### ç§»åŠ¨ç«¯ (<768px)
- å…¨å®½å¸ƒå±€ï¼Œæœ€å°è¾¹è·
- æ‰€æœ‰ä¿¡æ¯å‚ç›´å †å 
- ç²¾ç®€ç»Ÿè®¡æ˜¾ç¤º

---

## 4. äº¤äº’è®¾è®¡

### 4.1 ä¸‹è½½äº¤äº’

```
ä¸‹è½½æµç¨‹ï¼š
1. ç‚¹å‡»ä¸‹è½½æŒ‰é’®
2. æ˜¾ç¤º"å‡†å¤‡ä¸­..."
3. å¼€å§‹ä¸‹è½½ï¼ˆæµè§ˆå™¨æ¥ç®¡ï¼‰
4. å®Œæˆåæ˜¾ç¤º"å·²ä¸‹è½½"
```

### 4.2 è´¨é‡å¯è§†åŒ–

```javascript
// è´¨é‡åˆ†å¸ƒå›¾è¡¨
const qualityChart = {
  type: 'doughnut',
  data: {
    labels: ['é«˜è´¨é‡', 'ä¸­ç­‰', 'ä½è´¨é‡', 'å¤±è´¥'],
    values: [750, 100, 4, 2],
    colors: ['#4CAF50', '#FFC107', '#FF5722', '#9E9E9E']
  }
};

// ç½®ä¿¡åº¦è¿›åº¦æ¡
const confidenceBar = {
  value: 94.5,
  color: getColorByConfidence(94.5), // åŠ¨æ€é¢œè‰²
  animated: true
};
```

### 4.3 å¤±è´¥å¤„ç†

```
å¤±è´¥ä»»åŠ¡å¤„ç†é€‰é¡¹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤±è´¥ä»»åŠ¡ (2)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [å…¨éƒ¨é‡è¯•]        â”‚ â†’ æ‰¹é‡é‡æ–°ç¿»è¯‘
â”‚ [é€ä¸ªå¤„ç†]        â”‚ â†’ æ‰‹åŠ¨ç¼–è¾‘
â”‚ [å¯¼å‡ºæ¸…å•]        â”‚ â†’ ä¸‹è½½å¤±è´¥åˆ—è¡¨
â”‚ [å¿½ç•¥]           â”‚ â†’ æ¥å—å½“å‰ç»“æœ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### 5.1 è§†è§‰å±‚æ¬¡

```
ä¿¡æ¯ä¼˜å…ˆçº§ï¼š
1. ä¸‹è½½æŒ‰é’® - æœ€çªå‡ºï¼Œä¸»è‰²è°ƒ
2. å®ŒæˆçŠ¶æ€ - å¤§æ ‡é¢˜ï¼ŒæˆåŠŸå›¾æ ‡
3. è´¨é‡æŒ‡æ ‡ - å¯è§†åŒ–å›¾è¡¨
4. è¯¦ç»†ç»Ÿè®¡ - è¡¨æ ¼å½¢å¼
5. å¤±è´¥ä¿¡æ¯ - å¯æŠ˜å é¢æ¿
```

### 5.2 åŠ è½½ä¼˜åŒ–

- **é¢„åŠ è½½ç»Ÿè®¡**: æ‰§è¡Œå®Œæˆå‰é¢„å–æ•°æ®
- **æ¸è¿›æ˜¾ç¤º**: å…ˆæ˜¾ç¤ºä¸»è¦ä¿¡æ¯ï¼Œè¯¦æƒ…å¼‚æ­¥åŠ è½½
- **æ‡’åŠ è½½å›¾è¡¨**: è§†å£å¯è§æ—¶æ‰æ¸²æŸ“å›¾è¡¨

### 5.3 æ“ä½œå¼•å¯¼

```
æ–°ç”¨æˆ·å¼•å¯¼ï¼š
1. é«˜äº®ä¸‹è½½æŒ‰é’®
2. æç¤ºæŸ¥çœ‹è´¨é‡æŠ¥å‘Š
3. è¯´æ˜åç»­æ“ä½œé€‰é¡¹
```

---

## 6. APIé›†æˆ

### 6.1 è·å–å®Œæˆç»Ÿè®¡

```javascript
async function getCompletionSummary(sessionId) {
  try {
    const response = await fetch(`/api/monitor/summary/${sessionId}`);

    if (!response.ok) {
      throw new Error('Failed to get summary');
    }

    const summary = await response.json();
    updateSummaryUI(summary);

  } catch (error) {
    console.error('Error fetching summary:', error);
    // æ˜¾ç¤ºåŸºç¡€ä¿¡æ¯
    showBasicCompletion();
  }
}
```

### 6.2 ä¸‹è½½æ–‡ä»¶

```javascript
async function downloadResult(sessionId) {
  // æ›´æ–°UIçŠ¶æ€
  setDownloadStatus('preparing');

  try {
    // åˆ›å»ºéšè—çš„ä¸‹è½½é“¾æ¥
    const link = document.createElement('a');
    link.href = `/api/download/${sessionId}`;
    link.download = `translated_${sessionId}.xlsx`;

    // è§¦å‘ä¸‹è½½
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);

    // æ›´æ–°çŠ¶æ€
    setDownloadStatus('completed');

    // è®°å½•ä¸‹è½½
    trackDownload(sessionId);

  } catch (error) {
    setDownloadStatus('error');
    showError('ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•');
  }
}
```

### 6.3 é‡æ–°ç¿»è¯‘

```javascript
async function retryFailedTasks(sessionId) {
  const confirmation = confirm('ç¡®å®šè¦é‡æ–°ç¿»è¯‘å¤±è´¥çš„ä»»åŠ¡å—ï¼Ÿ');

  if (confirmation) {
    // è·å–å¤±è´¥ä»»åŠ¡åˆ—è¡¨
    const failedTasks = await getFailedTasks(sessionId);

    // åˆ›å»ºæ–°çš„ç¿»è¯‘ä»»åŠ¡
    const newSession = await createRetrySession(sessionId, failedTasks);

    // è·³è½¬åˆ°æ‰§è¡Œé¡µ
    window.location.hash = `#/execute/${newSession.id}`;
  }
}
```

---

## 7. çŠ¶æ€ç®¡ç†

### 7.1 é¡µé¢çŠ¶æ€

```javascript
pageState = {
  // ä¼šè¯ä¿¡æ¯
  sessionId: 'xxx-xxx',
  fileName: 'translations.xlsx',

  // å®Œæˆç»Ÿè®¡
  summary: {
    totalTasks: 856,
    completed: 854,
    failed: 2,
    successRate: 99.77,
    totalTime: 305,
    averageConfidence: 94.5
  },

  // è´¨é‡æ•°æ®
  qualityData: {
    distribution: null,
    languageStats: null
  },

  // ä¸‹è½½çŠ¶æ€
  downloadStatus: 'ready', // ready|preparing|completed|error
  downloadCount: 0,

  // UIçŠ¶æ€
  showFailedTasks: false,
  showDetailedReport: false
}
```

### 7.2 æ•°æ®ç¼“å­˜

```javascript
// ç¼“å­˜å®Œæˆæ•°æ®
function cacheSummary(sessionId, summary) {
  const cacheKey = `summary_${sessionId}`;

  localStorage.setItem(cacheKey, JSON.stringify({
    data: summary,
    timestamp: Date.now(),
    expires: Date.now() + 3600000 // 1å°æ—¶
  }));
}

// è·å–ç¼“å­˜
function getCachedSummary(sessionId) {
  const cacheKey = `summary_${sessionId}`;
  const cached = localStorage.getItem(cacheKey);

  if (cached) {
    const { data, expires } = JSON.parse(cached);

    if (Date.now() < expires) {
      return data;
    }
  }

  return null;
}
```

### 7.3 ä¼šè¯è¶…æ—¶æé†’

```javascript
// å®Œæˆé¡µçš„è¶…æ—¶ç®¡ç†ï¼ˆå¼ºè°ƒä¸‹è½½çš„ç´§è¿«æ€§ï¼‰
class CompletionTimeoutManager {
  constructor(sessionId) {
    const session = JSON.parse(localStorage.getItem('currentSession'));
    this.expiresAt = session.expiresAt;
    this.hasDownloaded = false;
    this.startMonitoring();
  }

  startMonitoring() {
    this.checkInterval = setInterval(() => {
      const remaining = this.expiresAt - Date.now();

      if (remaining <= 0) {
        this.handleExpired();
      } else if (remaining <= 30 * 60 * 1000 && !this.hasDownloaded) {
        // 30åˆ†é’Ÿå†…æœªä¸‹è½½ï¼Œæ˜¾ç¤ºç´§æ€¥æé†’
        this.showUrgentWarning(remaining);
      }

      this.updateDisplay(remaining);
    }, 60000); // æ¯åˆ†é’Ÿæ£€æŸ¥
  }

  showUrgentWarning(remaining) {
    const minutes = Math.floor(remaining / 60000);

    showWarning({
      type: 'urgent',
      title: 'âš ï¸ æ•°æ®å³å°†æ¸…é™¤',
      message: `æ‚¨çš„ç¿»è¯‘ç»“æœå°†åœ¨ ${minutes} åˆ†é’Ÿåæ°¸ä¹…åˆ é™¤ï¼Œè¯·ç«‹å³ä¸‹è½½ï¼`,
      persistent: true,
      actions: [
        {
          label: 'ç«‹å³ä¸‹è½½',
          primary: true,
          action: () => {
            downloadResult();
            this.hasDownloaded = true;
          }
        }
      ]
    });

    // æ·»åŠ è§†è§‰æé†’
    document.body.classList.add('urgent-warning');

    // é—ªçƒä¸‹è½½æŒ‰é’®
    const downloadBtn = document.getElementById('download-btn');
    if (downloadBtn) {
      downloadBtn.classList.add('pulse-animation');
    }
  }

  updateDisplay(remaining) {
    const hours = Math.floor(remaining / 3600000);
    const minutes = Math.floor((remaining % 3600000) / 60000);

    const display = document.getElementById('session-expiry');
    if (display) {
      if (remaining < 30 * 60 * 1000) {
        display.innerHTML = `âš ï¸ ä¼šè¯å‰©ä½™: ${hours}:${minutes.toString().padStart(2, '0')} è¯·å°½å¿«ä¸‹è½½`;
        display.classList.add('critical');
      } else {
        display.textContent = `ä¼šè¯å‰©ä½™: ${hours}:${minutes.toString().padStart(2, '0')}`;
      }
    }
  }

  handleExpired() {
    clearInterval(this.checkInterval);

    if (!this.hasDownloaded) {
      showError({
        title: 'ä¼šè¯å·²è¿‡æœŸ',
        message: 'æ‚¨çš„ç¿»è¯‘ç»“æœå·²è¢«æ¸…é™¤ï¼Œå› ä¸ºæœªåœ¨8å°æ—¶å†…ä¸‹è½½',
        blocking: true,
        action: () => window.location.hash = '#/create'
      });
    }
  }
}

// é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
const timeoutManager = new CompletionTimeoutManager(sessionId);

// ä¸‹è½½æˆåŠŸåæ›´æ–°çŠ¶æ€
function onDownloadComplete() {
  timeoutManager.hasDownloaded = true;

  showSuccess({
    title: 'ä¸‹è½½æˆåŠŸ',
    message: 'æ–‡ä»¶å·²ä¿å­˜åˆ°æœ¬åœ°ã€‚æç¤ºï¼šæœåŠ¡å™¨æ•°æ®å°†åœ¨ä¼šè¯è¿‡æœŸåè‡ªåŠ¨æ¸…é™¤ã€‚',
    duration: 5000
  });
}
```

---

## 8. å¼‚å¸¸åœºæ™¯å¤„ç†

### 8.1 ä¸‹è½½å¤±è´¥

```
å¤„ç†ç­–ç•¥ï¼š
1. è‡ªåŠ¨é‡è¯• â†’ æœ€å¤š3æ¬¡
2. æä¾›å¤‡ç”¨é“¾æ¥ â†’ ç›´æ¥URLè®¿é—®
3. ç”Ÿæˆæ–°é“¾æ¥ â†’ é‡æ–°è¯·æ±‚ä¸‹è½½
4. è”ç³»æ”¯æŒ â†’ æ˜¾ç¤ºé”™è¯¯ä»£ç 
```

### 8.2 æ•°æ®ä¸ä¸€è‡´

```
æ ¡éªŒæœºåˆ¶ï¼š
1. æ€»æ•°æ ¡éªŒ â†’ completed + failed = total
2. æ—¶é—´æ ¡éªŒ â†’ ç¡®ä¿æ—¶é—´æˆ³åˆç†
3. çŠ¶æ€æ ¡éªŒ â†’ ç¡®ä¿çŠ¶æ€ä¸ºcompleted
```

### 8.3 ä¼šè¯è¿‡æœŸ

```
æ¢å¤æ–¹æ¡ˆï¼š
1. æ£€æµ‹è¿‡æœŸ â†’ APIè¿”å›404
2. å°è¯•æ¢å¤ â†’ ä»localStorageæŸ¥æ‰¾
3. æç¤ºç”¨æˆ· â†’ æ˜¾ç¤ºå†å²æ•°æ®
4. é‡æ–°ç”Ÿæˆ â†’ åŸºäºç¼“å­˜é‡å»º
```

---

## 9. æ€§èƒ½ä¼˜åŒ–

### 9.1 å…³é”®æŒ‡æ ‡

- **é¡µé¢åŠ è½½**: < 800ms
- **ç»Ÿè®¡è·å–**: < 500ms
- **ä¸‹è½½å“åº”**: < 200ms
- **å›¾è¡¨æ¸²æŸ“**: < 300ms

### 9.2 ä¼˜åŒ–ç­–ç•¥

```javascript
// 1. é¢„å–æ•°æ®
if (executionProgress > 95) {
  prefetchSummary(sessionId);
}

// 2. å»¶è¿ŸåŠ è½½
const loadCharts = () => {
  if ('IntersectionObserver' in window) {
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          renderChart(entry.target);
        }
      });
    });
  }
};

// 3. å›¾ç‰‡æ‡’åŠ è½½
const lazyLoadIcons = () => {
  document.querySelectorAll('img[data-src]').forEach(img => {
    img.src = img.dataset.src;
  });
};
```

---

## 10. æµ‹è¯•è¦ç‚¹

### 10.1 åŠŸèƒ½æµ‹è¯•

- [ ] ç»Ÿè®¡æ•°æ®å‡†ç¡®æ€§
- [ ] ä¸‹è½½åŠŸèƒ½å®Œæ•´æ€§
- [ ] å¤±è´¥ä»»åŠ¡å¤„ç†
- [ ] é‡æ–°ç¿»è¯‘æµç¨‹
- [ ] æŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½

### 10.2 è¾¹ç•Œæµ‹è¯•

- [ ] é›¶å¤±è´¥ä»»åŠ¡æ˜¾ç¤º
- [ ] å¤§é‡å¤±è´¥ä»»åŠ¡ï¼ˆ>100ï¼‰
- [ ] è¶…é•¿æ–‡ä»¶åå¤„ç†
- [ ] å¹¶å‘ä¸‹è½½è¯·æ±‚

### 10.3 å…¼å®¹æ€§æµ‹è¯•

- [ ] ä¸åŒæµè§ˆå™¨ä¸‹è½½è¡Œä¸º
- [ ] ç§»åŠ¨ç«¯ä¸‹è½½ä½“éªŒ
- [ ] å¤§æ–‡ä»¶ä¸‹è½½ï¼ˆ>50MBï¼‰
- [ ] ç½‘ç»œå¼‚å¸¸æ¢å¤

---

## 11. è®¾è®¡è§„èŒƒ

### 11.1 é¢œè‰²å®šä¹‰

```css
/* çŠ¶æ€é¢œè‰² */
--success-color: #4CAF50;
--warning-color: #FFC107;
--error-color: #FF5722;
--info-color: #2196F3;

/* è´¨é‡ç­‰çº§ */
--quality-high: #4CAF50;
--quality-medium: #FFC107;
--quality-low: #FF5722;
```

### 11.2 åŠ¨ç”»æ•ˆæœ

```css
/* è¿›åº¦æ¡åŠ¨ç”» */
@keyframes progressFill {
  from { width: 0; }
  to { width: var(--progress); }
}

/* æˆåŠŸå›¾æ ‡åŠ¨ç”» */
@keyframes successCheck {
  0% { stroke-dashoffset: 100; }
  100% { stroke-dashoffset: 0; }
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**åŸºäºåç«¯**: download_api.py, monitor_api.py
**åˆ›å»ºæ—¥æœŸ**: 2025-10-04
**ä½œè€…**: UX Team