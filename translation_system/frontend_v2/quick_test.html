<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Translation System V2 - APIå¿«é€Ÿæµ‹è¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .test-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .test-card h2 {
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .test-group {
            margin-bottom: 15px;
        }

        .test-group h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .test-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px;
            background: #f7f7f7;
            border-radius: 5px;
        }

        .test-item button {
            padding: 5px 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            font-size: 12px;
        }

        .test-item button:hover {
            background: #5a67d8;
        }

        .test-item button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .test-status {
            flex-grow: 1;
            font-size: 12px;
        }

        .status-pending { color: #999; }
        .status-testing { color: #f39c12; }
        .status-success { color: #27ae60; }
        .status-error { color: #e74c3c; }

        .config-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .config-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            align-items: center;
        }

        .config-row label {
            min-width: 100px;
            color: #666;
        }

        .config-row input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .file-upload {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            background: #f0f0f0;
        }

        .file-upload.dragover {
            background: #e8eaf6;
            border-color: #5a67d8;
        }

        .results-panel {
            background: #2c3e50;
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-left: 3px solid transparent;
        }

        .log-entry.success { border-left-color: #27ae60; }
        .log-entry.error { border-left-color: #e74c3c; }
        .log-entry.info { border-left-color: #3498db; }
        .log-entry.warning { border-left-color: #f39c12; }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .websocket-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ws-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #e74c3c;
        }

        .ws-indicator.connected {
            background: #27ae60;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(39, 174, 96, 0); }
            100% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0); }
        }
    </style>
</head>
<body>
    <div class="websocket-status">
        <div class="ws-indicator" id="wsIndicator"></div>
        <span id="wsStatus">æœªè¿æ¥</span>
    </div>

    <div class="container">
        <h1>ğŸš€ Translation System V2 - APIå¿«é€Ÿæµ‹è¯•å·¥å…·</h1>

        <!-- é…ç½®é¢æ¿ -->
        <div class="config-panel">
            <h2>âš™ï¸ åŸºç¡€é…ç½®</h2>
            <div class="config-row">
                <label>APIåœ°å€:</label>
                <input type="text" id="apiBase" value="http://localhost:8013" />
            </div>
            <div class="config-row">
                <label>Session ID:</label>
                <input type="text" id="sessionId" placeholder="å°†åœ¨ä¸Šä¼ åè‡ªåŠ¨å¡«å……" />
            </div>
            <div class="config-row">
                <label>æµ‹è¯•æ–‡ä»¶:</label>
                <input type="file" id="testFile" accept=".xlsx,.xls" />
            </div>
        </div>

        <!-- æµ‹è¯•ç½‘æ ¼ -->
        <div class="test-grid">
            <!-- ä¸Šä¼ ä¸ä¼šè¯æµ‹è¯• -->
            <div class="test-card">
                <h2>ğŸ“ ä¸Šä¼ ä¸ä¼šè¯ç®¡ç†</h2>

                <div class="test-group">
                    <h3>æ–‡ä»¶ä¸Šä¼ </h3>
                    <div class="test-item">
                        <button onclick="testUpload()">æµ‹è¯•ä¸Šä¼ </button>
                        <span class="test-status status-pending" id="status-upload">å¾…æµ‹è¯•</span>
                    </div>
                </div>

                <div class="test-group">
                    <h3>ä¼šè¯ç®¡ç†</h3>
                    <div class="test-item">
                        <button onclick="testGetSessions()">è·å–ä¼šè¯åˆ—è¡¨</button>
                        <span class="test-status status-pending" id="status-sessions">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <button onclick="testGetSession()">è·å–ä¼šè¯è¯¦æƒ…</button>
                        <span class="test-status status-pending" id="status-session">å¾…æµ‹è¯•</span>
                    </div>
                </div>
            </div>

            <!-- åˆ†æä¸æ‹†åˆ†æµ‹è¯• -->
            <div class="test-card">
                <h2>ğŸ“Š åˆ†æä¸ä»»åŠ¡æ‹†åˆ†</h2>

                <div class="test-group">
                    <h3>æ–‡ä»¶åˆ†æ</h3>
                    <div class="test-item">
                        <button onclick="testAnalyze()">åˆ†ææ–‡ä»¶</button>
                        <span class="test-status status-pending" id="status-analyze">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <button onclick="testPreview()">é¢„è§ˆå†…å®¹</button>
                        <span class="test-status status-pending" id="status-preview">å¾…æµ‹è¯•</span>
                    </div>
                </div>

                <div class="test-group">
                    <h3>ä»»åŠ¡æ‹†åˆ†</h3>
                    <div class="test-item">
                        <button onclick="testSplit()">æ‰§è¡Œæ‹†åˆ†</button>
                        <span class="test-status status-pending" id="status-split">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <button onclick="testGetTasks()">è·å–ä»»åŠ¡åˆ—è¡¨</button>
                        <span class="test-status status-pending" id="status-tasks">å¾…æµ‹è¯•</span>
                    </div>
                </div>
            </div>

            <!-- æ‰§è¡Œä¸ç›‘æ§æµ‹è¯• -->
            <div class="test-card">
                <h2>âš¡ æ‰§è¡Œä¸ç›‘æ§</h2>

                <div class="test-group">
                    <h3>ç¿»è¯‘æ‰§è¡Œ</h3>
                    <div class="test-item">
                        <button onclick="testExecute()">å¼€å§‹æ‰§è¡Œ</button>
                        <span class="test-status status-pending" id="status-execute">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <button onclick="testPause()">æš‚åœæ‰§è¡Œ</button>
                        <span class="test-status status-pending" id="status-pause">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <button onclick="testResume()">æ¢å¤æ‰§è¡Œ</button>
                        <span class="test-status status-pending" id="status-resume">å¾…æµ‹è¯•</span>
                    </div>
                </div>

                <div class="test-group">
                    <h3>è¿›åº¦ç›‘æ§</h3>
                    <div class="test-item">
                        <button onclick="testProgress()">è·å–è¿›åº¦</button>
                        <span class="test-status status-pending" id="status-progress">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <button onclick="testWebSocket()">WebSocketè¿æ¥</button>
                        <span class="test-status status-pending" id="status-websocket">å¾…æµ‹è¯•</span>
                    </div>
                </div>
            </div>

            <!-- ç»“æœä¸å¯¼å‡ºæµ‹è¯• -->
            <div class="test-card">
                <h2>ğŸ“¥ ç»“æœä¸å¯¼å‡º</h2>

                <div class="test-group">
                    <h3>ç»“æœç®¡ç†</h3>
                    <div class="test-item">
                        <button onclick="testGetResults()">è·å–ç»“æœ</button>
                        <span class="test-status status-pending" id="status-results">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <button onclick="testStatistics()">ç»“æœç»Ÿè®¡</button>
                        <span class="test-status status-pending" id="status-statistics">å¾…æµ‹è¯•</span>
                    </div>
                </div>

                <div class="test-group">
                    <h3>æ–‡ä»¶å¯¼å‡º</h3>
                    <div class="test-item">
                        <button onclick="testExport()">ç”Ÿæˆå¯¼å‡º</button>
                        <span class="test-status status-pending" id="status-export">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <button onclick="testDownload()">ä¸‹è½½æ–‡ä»¶</button>
                        <span class="test-status status-pending" id="status-download">å¾…æµ‹è¯•</span>
                    </div>
                </div>
            </div>

            <!-- é«˜çº§åŠŸèƒ½æµ‹è¯• -->
            <div class="test-card">
                <h2>ğŸ”§ é«˜çº§åŠŸèƒ½</h2>

                <div class="test-group">
                    <h3>LLMé…ç½®</h3>
                    <div class="test-item">
                        <button onclick="testProviders()">è·å–æä¾›å•†</button>
                        <span class="test-status status-pending" id="status-providers">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <button onclick="testLLMConfig()">é…ç½®LLM</button>
                        <span class="test-status status-pending" id="status-llm-config">å¾…æµ‹è¯•</span>
                    </div>
                </div>

                <div class="test-group">
                    <h3>ç³»ç»Ÿç›‘æ§</h3>
                    <div class="test-item">
                        <button onclick="testMonitor()">ç³»ç»Ÿç›‘æ§</button>
                        <span class="test-status status-pending" id="status-monitor">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <button onclick="testCosts()">æˆæœ¬ç»Ÿè®¡</button>
                        <span class="test-status status-pending" id="status-costs">å¾…æµ‹è¯•</span>
                    </div>
                </div>
            </div>

            <!-- å®Œæ•´æµç¨‹æµ‹è¯• -->
            <div class="test-card">
                <h2>ğŸ”„ ç«¯åˆ°ç«¯æµ‹è¯•</h2>

                <div class="test-group">
                    <h3>å®Œæ•´æµç¨‹</h3>
                    <div class="test-item">
                        <button onclick="testFullFlow()" style="background: #e74c3c;">å®Œæ•´ç¿»è¯‘æµç¨‹</button>
                        <span class="test-status status-pending" id="status-full-flow">å¾…æµ‹è¯•</span>
                    </div>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%">0%</div>
                </div>
            </div>
        </div>

        <!-- ç»“æœé¢æ¿ -->
        <div class="results-panel" id="resultsPanel">
            <div class="log-entry info">ğŸ¯ æµ‹è¯•å·¥å…·å·²å°±ç»ªï¼Œè¯·é€‰æ‹©æµ‹è¯•é¡¹ç›®å¼€å§‹éªŒè¯...</div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let ws = null;
        let currentSessionId = null;

        // å·¥å…·å‡½æ•°
        function getApiBase() {
            return document.getElementById('apiBase').value;
        }

        function getSessionId() {
            return document.getElementById('sessionId').value || currentSessionId;
        }

        function updateStatus(id, status, message) {
            const element = document.getElementById(`status-${id}`);
            element.className = `test-status status-${status}`;
            element.textContent = message;
        }

        function log(message, type = 'info') {
            const panel = document.getElementById('resultsPanel');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            panel.appendChild(entry);
            panel.scrollTop = panel.scrollHeight;
        }

        function updateProgress(percent) {
            const bar = document.getElementById('progressBar');
            bar.style.width = `${percent}%`;
            bar.textContent = `${percent}%`;
        }

        // APIæµ‹è¯•å‡½æ•°
        async function testUpload() {
            const fileInput = document.getElementById('testFile');
            if (!fileInput.files[0]) {
                log('è¯·å…ˆé€‰æ‹©æµ‹è¯•æ–‡ä»¶', 'error');
                return;
            }

            updateStatus('upload', 'testing', 'æµ‹è¯•ä¸­...');

            try {
                const formData = new FormData();
                formData.append('file', fileInput.files[0]);

                const response = await axios.post(`${getApiBase()}/api/analyze/upload`, formData);

                currentSessionId = response.data.session_id;
                document.getElementById('sessionId').value = currentSessionId;

                updateStatus('upload', 'success', 'âœ… æˆåŠŸ');
                log(`ä¸Šä¼ æˆåŠŸ! Session ID: ${currentSessionId}`, 'success');
                log(JSON.stringify(response.data, null, 2), 'info');
            } catch (error) {
                updateStatus('upload', 'error', 'âŒ å¤±è´¥');
                log(`ä¸Šä¼ å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testGetSessions() {
            updateStatus('sessions', 'testing', 'æµ‹è¯•ä¸­...');

            try {
                const response = await axios.get(`${getApiBase()}/api/sessions`);
                updateStatus('sessions', 'success', 'âœ… æˆåŠŸ');
                log(`è·å–åˆ° ${response.data.length} ä¸ªä¼šè¯`, 'success');
                log(JSON.stringify(response.data, null, 2), 'info');
            } catch (error) {
                updateStatus('sessions', 'error', 'âŒ å¤±è´¥');
                log(`è·å–ä¼šè¯åˆ—è¡¨å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testGetSession() {
            const sessionId = getSessionId();
            if (!sessionId) {
                log('è¯·å…ˆä¸Šä¼ æ–‡ä»¶æˆ–è¾“å…¥Session ID', 'error');
                return;
            }

            updateStatus('session', 'testing', 'æµ‹è¯•ä¸­...');

            try {
                const response = await axios.get(`${getApiBase()}/api/sessions/${sessionId}`);
                updateStatus('session', 'success', 'âœ… æˆåŠŸ');
                log(`è·å–ä¼šè¯è¯¦æƒ…æˆåŠŸ`, 'success');
                log(JSON.stringify(response.data, null, 2), 'info');
            } catch (error) {
                updateStatus('session', 'error', 'âŒ å¤±è´¥');
                log(`è·å–ä¼šè¯è¯¦æƒ…å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testAnalyze() {
            const sessionId = getSessionId();
            if (!sessionId) {
                log('è¯·å…ˆä¸Šä¼ æ–‡ä»¶', 'error');
                return;
            }

            updateStatus('analyze', 'testing', 'æµ‹è¯•ä¸­...');

            try {
                const response = await axios.post(`${getApiBase()}/api/analyze/${sessionId}`, {
                    colors: ['yellow', 'blue'],
                    detect_language: true
                });
                updateStatus('analyze', 'success', 'âœ… æˆåŠŸ');
                log(`åˆ†æå®Œæˆ: ${response.data.total_cells} ä¸ªå•å…ƒæ ¼`, 'success');
                log(JSON.stringify(response.data, null, 2), 'info');
            } catch (error) {
                updateStatus('analyze', 'error', 'âŒ å¤±è´¥');
                log(`åˆ†æå¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testSplit() {
            const sessionId = getSessionId();
            if (!sessionId) {
                log('è¯·å…ˆä¸Šä¼ å¹¶åˆ†ææ–‡ä»¶', 'error');
                return;
            }

            updateStatus('split', 'testing', 'æµ‹è¯•ä¸­...');

            try {
                const response = await axios.post(`${getApiBase()}/api/split/${sessionId}`, {
                    colors: ['yellow', 'blue'],
                    source_lang: 'CH',
                    target_lang: 'PT',
                    strategy: 'default'
                });
                updateStatus('split', 'success', 'âœ… æˆåŠŸ');
                log(`æ‹†åˆ†å®Œæˆ: ${response.data.task_count} ä¸ªä»»åŠ¡`, 'success');
                log(JSON.stringify(response.data, null, 2), 'info');
            } catch (error) {
                updateStatus('split', 'error', 'âŒ å¤±è´¥');
                log(`æ‹†åˆ†å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testExecute() {
            const sessionId = getSessionId();
            if (!sessionId) {
                log('è¯·å…ˆå®Œæˆä»»åŠ¡æ‹†åˆ†', 'error');
                return;
            }

            updateStatus('execute', 'testing', 'æµ‹è¯•ä¸­...');

            try {
                const response = await axios.post(`${getApiBase()}/api/execute/${sessionId}`, {
                    batch_size: 5,
                    max_workers: 3,
                    use_batch_optimization: true
                });
                updateStatus('execute', 'success', 'âœ… æˆåŠŸ');
                log(`æ‰§è¡Œå¼€å§‹: ${response.data.execution_id}`, 'success');
                log(JSON.stringify(response.data, null, 2), 'info');
            } catch (error) {
                updateStatus('execute', 'error', 'âŒ å¤±è´¥');
                log(`æ‰§è¡Œå¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testProgress() {
            const sessionId = getSessionId();
            if (!sessionId) {
                log('è¯·å…ˆå¼€å§‹æ‰§è¡Œ', 'error');
                return;
            }

            updateStatus('progress', 'testing', 'æµ‹è¯•ä¸­...');

            try {
                const response = await axios.get(`${getApiBase()}/api/progress/${sessionId}`);
                updateStatus('progress', 'success', 'âœ… æˆåŠŸ');
                const progress = response.data;
                log(`è¿›åº¦: ${progress.completed}/${progress.total} (${progress.rate}%)`, 'success');
                updateProgress(Math.round(progress.rate));
                log(JSON.stringify(response.data, null, 2), 'info');
            } catch (error) {
                updateStatus('progress', 'error', 'âŒ å¤±è´¥');
                log(`è·å–è¿›åº¦å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testWebSocket() {
            const sessionId = getSessionId();
            if (!sessionId) {
                log('è¯·å…ˆä¸Šä¼ æ–‡ä»¶', 'error');
                return;
            }

            updateStatus('websocket', 'testing', 'è¿æ¥ä¸­...');

            const wsUrl = `${getApiBase().replace('http', 'ws')}/ws/progress/${sessionId}`;

            try {
                ws = new WebSocket(wsUrl);

                ws.onopen = () => {
                    updateStatus('websocket', 'success', 'âœ… å·²è¿æ¥');
                    log(`WebSocketè¿æ¥æˆåŠŸ: ${wsUrl}`, 'success');
                    document.getElementById('wsIndicator').classList.add('connected');
                    document.getElementById('wsStatus').textContent = 'å·²è¿æ¥';
                };

                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    log(`WSæ¶ˆæ¯: ${data.type}`, 'info');

                    if (data.type === 'progress_update') {
                        const progress = data.progress;
                        const rate = Math.round((progress.completed / progress.total) * 100);
                        updateProgress(rate);
                    }
                };

                ws.onerror = (error) => {
                    updateStatus('websocket', 'error', 'âŒ è¿æ¥å¤±è´¥');
                    log(`WebSocketé”™è¯¯: ${error}`, 'error');
                };

                ws.onclose = () => {
                    log('WebSocketè¿æ¥å·²å…³é—­', 'warning');
                    document.getElementById('wsIndicator').classList.remove('connected');
                    document.getElementById('wsStatus').textContent = 'æœªè¿æ¥';
                };

            } catch (error) {
                updateStatus('websocket', 'error', 'âŒ å¤±è´¥');
                log(`WebSocketè¿æ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testGetResults() {
            const sessionId = getSessionId();
            updateStatus('results', 'testing', 'æµ‹è¯•ä¸­...');

            try {
                const response = await axios.get(`${getApiBase()}/api/results/${sessionId}`);
                updateStatus('results', 'success', 'âœ… æˆåŠŸ');
                log(`è·å–åˆ° ${response.data.results.length} ä¸ªç»“æœ`, 'success');
            } catch (error) {
                updateStatus('results', 'error', 'âŒ å¤±è´¥');
                log(`è·å–ç»“æœå¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testDownload() {
            const sessionId = getSessionId();
            updateStatus('download', 'testing', 'æµ‹è¯•ä¸­...');

            try {
                const response = await axios.get(`${getApiBase()}/api/download/${sessionId}`, {
                    responseType: 'blob'
                });

                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const url = window.URL.createObjectURL(new Blob([response.data]));
                const link = document.createElement('a');
                link.href = url;
                link.setAttribute('download', `translated_${sessionId}.xlsx`);
                document.body.appendChild(link);
                link.click();
                link.remove();

                updateStatus('download', 'success', 'âœ… æˆåŠŸ');
                log('æ–‡ä»¶ä¸‹è½½æˆåŠŸ', 'success');
            } catch (error) {
                updateStatus('download', 'error', 'âŒ å¤±è´¥');
                log(`ä¸‹è½½å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // å®Œæ•´æµç¨‹æµ‹è¯•
        async function testFullFlow() {
            log('===== å¼€å§‹å®Œæ•´æµç¨‹æµ‹è¯• =====', 'warning');
            updateStatus('full-flow', 'testing', 'æ‰§è¡Œä¸­...');

            try {
                // 1. ä¸Šä¼ 
                log('æ­¥éª¤1: ä¸Šä¼ æ–‡ä»¶', 'info');
                await testUpload();
                await sleep(1000);
                updateProgress(15);

                // 2. åˆ†æ
                log('æ­¥éª¤2: åˆ†ææ–‡ä»¶', 'info');
                await testAnalyze();
                await sleep(1000);
                updateProgress(30);

                // 3. æ‹†åˆ†
                log('æ­¥éª¤3: æ‹†åˆ†ä»»åŠ¡', 'info');
                await testSplit();
                await sleep(1000);
                updateProgress(45);

                // 4. æ‰§è¡Œ
                log('æ­¥éª¤4: æ‰§è¡Œç¿»è¯‘', 'info');
                await testExecute();
                await sleep(1000);
                updateProgress(60);

                // 5. WebSocket
                log('æ­¥éª¤5: å»ºç«‹WebSocketè¿æ¥', 'info');
                testWebSocket();
                await sleep(2000);
                updateProgress(75);

                // 6. è¿›åº¦
                log('æ­¥éª¤6: æ£€æŸ¥è¿›åº¦', 'info');
                await testProgress();
                await sleep(1000);
                updateProgress(90);

                // 7. ç»“æœ
                log('æ­¥éª¤7: è·å–ç»“æœ', 'info');
                await testGetResults();
                updateProgress(100);

                updateStatus('full-flow', 'success', 'âœ… å®Œæˆ');
                log('===== å®Œæ•´æµç¨‹æµ‹è¯•å®Œæˆ =====', 'success');

            } catch (error) {
                updateStatus('full-flow', 'error', 'âŒ å¤±è´¥');
                log(`å®Œæ•´æµç¨‹æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // å…¶ä»–æµ‹è¯•å‡½æ•°çš„ç®€å•å®ç°
        async function testPreview() { await makeTestCall('preview', 'GET', `/api/analyze/${getSessionId()}/preview`); }
        async function testGetTasks() { await makeTestCall('tasks', 'GET', `/api/split/${getSessionId()}/tasks`); }
        async function testPause() { await makeTestCall('pause', 'POST', `/api/execute/${getSessionId()}/pause`); }
        async function testResume() { await makeTestCall('resume', 'POST', `/api/execute/${getSessionId()}/resume`); }
        async function testStatistics() { await makeTestCall('statistics', 'GET', `/api/results/${getSessionId()}/statistics`); }
        async function testExport() { await makeTestCall('export', 'POST', `/api/export/${getSessionId()}`); }
        async function testProviders() { await makeTestCall('providers', 'GET', `/api/llm/providers`); }
        async function testLLMConfig() { await makeTestCall('llm-config', 'GET', `/api/llm/config`); }
        async function testMonitor() { await makeTestCall('monitor', 'GET', `/api/monitor/system`); }
        async function testCosts() { await makeTestCall('costs', 'GET', `/api/monitor/costs`); }

        async function makeTestCall(id, method, url, data = null) {
            updateStatus(id, 'testing', 'æµ‹è¯•ä¸­...');
            try {
                const config = { method, url: getApiBase() + url };
                if (data) config.data = data;
                const response = await axios(config);
                updateStatus(id, 'success', 'âœ… æˆåŠŸ');
                log(`${id} æµ‹è¯•æˆåŠŸ`, 'success');
                log(JSON.stringify(response.data, null, 2), 'info');
            } catch (error) {
                updateStatus(id, 'error', 'âŒ å¤±è´¥');
                log(`${id} æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        window.onload = () => {
            log('æµ‹è¯•å·¥å…·åŠ è½½å®Œæˆ', 'success');
            log(`APIåŸºç¡€åœ°å€: ${getApiBase()}`, 'info');
        };
    </script>
</body>
</html>