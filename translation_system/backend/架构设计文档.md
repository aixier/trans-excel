# æ¸¸æˆæœ¬åœ°åŒ–æ™ºèƒ½ç¿»è¯‘ç³»ç»Ÿ - æ¶æ„è®¾è®¡æ–‡æ¡£

> ç‰ˆæœ¬: 2.0
> æ›´æ–°æ—¥æœŸ: 2025-01-25
> ä½œè€…: System Architecture Team

## ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æ•´ä½“æ¶æ„](#æ•´ä½“æ¶æ„)
3. [æ ¸å¿ƒæ¨¡å—è¯¦è§£](#æ ¸å¿ƒæ¨¡å—è¯¦è§£)
4. [æ•°æ®æµç¨‹](#æ•°æ®æµç¨‹)
5. [æ—¶åºå›¾](#æ—¶åºå›¾)
6. [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)
7. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)

---

## ç³»ç»Ÿæ¦‚è¿°

æ¸¸æˆæœ¬åœ°åŒ–æ™ºèƒ½ç¿»è¯‘ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºAIçš„Excelæ–‡ä»¶æ‰¹é‡ç¿»è¯‘å¹³å°ï¼Œä¸“é—¨é’ˆå¯¹æ¸¸æˆæ–‡æœ¬çš„å¤šè¯­è¨€æœ¬åœ°åŒ–éœ€æ±‚è®¾è®¡ã€‚ç³»ç»Ÿæ”¯æŒå¢é‡ç¿»è¯‘ã€é¢œè‰²æ ‡è®°ä»»åŠ¡è¯†åˆ«ã€è¿­ä»£ä¼˜åŒ–ç­‰é«˜çº§åŠŸèƒ½ã€‚

### æ ¸å¿ƒç‰¹æ€§
- ğŸš€ **é«˜æ€§èƒ½æ‰¹å¤„ç†**: æ”¯æŒå¹¶å‘ç¿»è¯‘ï¼ŒåŠ¨æ€æ‰¹æ¬¡è°ƒæ•´
- ğŸ¯ **æ™ºèƒ½ä»»åŠ¡è¯†åˆ«**: åŸºäºé¢œè‰²æ ‡è®°çš„ä¸‰é˜¶æ®µç¿»è¯‘ç­–ç•¥
- ğŸ”„ **è¿­ä»£ä¼˜åŒ–æœºåˆ¶**: æœ€å¤š5è½®è‡ªåŠ¨è¿­ä»£ï¼Œç¡®ä¿ç¿»è¯‘å®Œæ•´æ€§
- ğŸ’¾ **ç»Ÿä¸€ç¼“å­˜ç®¡ç†**: å†…å­˜ä¼˜å…ˆï¼Œå®šæ—¶æŒä¹…åŒ–ç­–ç•¥
- ğŸŒ **å¤šè¯­è¨€æ”¯æŒ**: PT/TH/INDç­‰å¤šè¯­è¨€ï¼Œæ”¯æŒåŒºåŸŸåŒ–é…ç½®
- ğŸ“Š **å®æ—¶è¿›åº¦ç›‘æ§**: WebSocketæ¨é€ï¼Œå®æ—¶æ›´æ–°ç¿»è¯‘è¿›åº¦

---

## æ•´ä½“æ¶æ„

### ç³»ç»Ÿæ¶æ„å›¾

```plantuml
@startuml System Architecture
!theme plain
skinparam backgroundColor #FAFAFA
skinparam componentStyle rectangle

package "Frontend Layer" {
  [Vue3 Pro Frontend] as Frontend
  [API Documentation] as APIDocs
}

package "API Gateway Layer" {
  [FastAPI Gateway] as Gateway
  component "Routers" {
    [Translation Router] as TransRouter
    [Project Router] as ProjRouter
    [Terminology Router] as TermRouter
    [Workspace Router] as WorkRouter
    [Health Check] as HealthRouter
  }
}

package "Business Logic Layer" {
  component "Translation Core" {
    [Translation Engine] as Engine
    [Phase Manager] as PhaseManager
    [Batch Processor] as BatchProc
  }

  component "Excel Analysis" {
    [Header Analyzer] as HeaderAnalyzer
    [Translation Detector] as Detector
    [Color Task Detector] as ColorDetector
  }

  component "Project Management" {
    [Project Manager] as ProjManager
    [Version Controller] as VersionCtrl
  }

  component "LLM Integration" {
    [Base LLM] as BaseLLM
    [OpenAI Provider] as OpenAILLM
    [Qwen Provider] as QwenLLM
    [DeepSeek Provider] as DeepSeekLLM
  }
}

package "Data Layer" {
  component "Cache Management" {
    [Task Repository] as TaskRepo
    [Memory Cache] as MemCache
  }

  database "MySQL Database" as MySQL {
    [translation_tasks]
    [projects]
    [terminology]
  }

  cloud "OSS Storage" as OSS {
    [Excel Files]
    [Translation Results]
  }
}

package "Infrastructure" {
  [Configuration] as Config
  [Logging System] as Logging
  [Error Handler] as ErrorHandler
}

Frontend --> Gateway : HTTP/WebSocket
APIDocs --> Gateway : OpenAPI

Gateway --> TransRouter
Gateway --> ProjRouter
Gateway --> TermRouter
Gateway --> WorkRouter
Gateway --> HealthRouter

TransRouter --> Engine
TransRouter --> TaskRepo
ProjRouter --> ProjManager
TermRouter --> MySQL
WorkRouter --> Engine

Engine --> PhaseManager
Engine --> BatchProc
Engine --> Detector
Engine --> ProjManager

PhaseManager --> ColorDetector
BatchProc --> BaseLLM
BaseLLM <|-- OpenAILLM
BaseLLM <|-- QwenLLM
BaseLLM <|-- DeepSeekLLM

Detector --> HeaderAnalyzer
ColorDetector --> HeaderAnalyzer

ProjManager --> TaskRepo
ProjManager --> MySQL
TaskRepo --> MemCache
TaskRepo --> MySQL : Periodic Flush

Engine --> OSS : Upload/Download
ProjManager --> VersionCtrl

@enduml
```

### æ¨¡å—ä¾èµ–å…³ç³»å›¾

```plantuml
@startuml Module Dependencies
!theme plain
skinparam packageStyle rectangle

package "api_gateway" {
  class main
  class routers.translation
  class routers.project
  class routers.health
  class routers.terminology
  class routers.workspace
}

package "translation_core" {
  class TranslationEngine
  class PhaseTranslationManager
  class BatchTranslationProcessor
}

package "excel_analysis" {
  class HeaderAnalyzer
  class TranslationDetector
  class ColorTaskDetector
}

package "project_manager" {
  class ProjectManager
  class VersionController
}

package "database" {
  class TaskRepository
  class connection
  class models
}

package "llm_providers" {
  class BaseLLM
  class OpenAILLM
  class QwenLLM
  class DeepSeekLLM
}

package "config" {
  class Settings
  class llm_configs
}

main --> routers.translation
main --> routers.project
main --> routers.health

routers.translation --> TranslationEngine
routers.translation --> TaskRepository
routers.project --> ProjectManager

TranslationEngine --> PhaseTranslationManager
TranslationEngine --> BatchTranslationProcessor
TranslationEngine --> TranslationDetector
TranslationEngine --> ProjectManager

PhaseTranslationManager --> ColorTaskDetector
BatchTranslationProcessor --> BaseLLM

TranslationDetector --> HeaderAnalyzer
ColorTaskDetector --> HeaderAnalyzer

ProjectManager --> TaskRepository
ProjectManager --> models

TaskRepository --> connection
TaskRepository --> models

BaseLLM <|-- OpenAILLM
BaseLLM <|-- QwenLLM
BaseLLM <|-- DeepSeekLLM

main ..> Settings
TranslationEngine ..> llm_configs
BaseLLM ..> llm_configs

@enduml
```

---

## æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. APIç½‘å…³å±‚ (api_gateway/)

#### ä¸»è¦èŒè´£
- è¯·æ±‚è·¯ç”±å’Œåˆ†å‘
- è®¤è¯æˆæƒï¼ˆé¢„ç•™ï¼‰
- è¯·æ±‚/å“åº”æ—¥å¿—
- å…¨å±€å¼‚å¸¸å¤„ç†
- CORSé…ç½®

#### æ ¸å¿ƒç»„ä»¶

```plantuml
@startuml API Gateway Components
!theme plain
class FastAPIApplication {
  +lifespan()
  +middleware()
  +exception_handler()
}

class TranslationRouter {
  +upload_file()
  +get_task_status()
  +get_task_progress()
  +list_tasks()
  +download_result()
}

class ProjectRouter {
  +create_project()
  +list_projects()
  +get_project_details()
  +update_project()
}

class HealthRouter {
  +health_check()
  +get_system_status()
}

FastAPIApplication --> TranslationRouter
FastAPIApplication --> ProjectRouter
FastAPIApplication --> HealthRouter

@enduml
```

### 2. ç¿»è¯‘æ ¸å¿ƒ (translation_core/)

#### TranslationEngine - ç¿»è¯‘å¼•æ“

```plantuml
@startuml Translation Engine Flow
!theme plain
start

:æ¥æ”¶ç¿»è¯‘ä»»åŠ¡;
:è§£æExcelæ–‡ä»¶;

:åˆ†æSheetç»“æ„;
note right: HeaderAnalyzer

:æ£€æµ‹ç¿»è¯‘ä»»åŠ¡;
note right: TranslationDetector

partition "è¿­ä»£ç¿»è¯‘å¾ªç¯" {
  while (iteration < max_iterations?) is (yes)
    :æ£€æµ‹å‰©ä½™ä»»åŠ¡;
    if (æœ‰å‰©ä½™ä»»åŠ¡?) then (yes)
      :åŠ¨æ€è°ƒæ•´æ‰¹æ¬¡å¤§å°;
      :åˆ›å»ºç¿»è¯‘æ‰¹æ¬¡;
      :å¹¶å‘å¤„ç†æ‰¹æ¬¡;
      :åº”ç”¨ç¿»è¯‘ç»“æœ;
      :æ›´æ–°è¿›åº¦;
    else (no)
      :é€€å‡ºè¿­ä»£;
      break
    endif
    :iteration++;
  endwhile (no)
}

:ä¸‰é˜¶æ®µé¢œè‰²ä»»åŠ¡å¤„ç†;
note right: Phase 1-3

:ä¿å­˜ç»“æœæ–‡ä»¶;
:æ›´æ–°ä»»åŠ¡çŠ¶æ€;

stop

@enduml
```

#### æ‰¹å¤„ç†å™¨å·¥ä½œæµç¨‹

```plantuml
@startuml Batch Processor
!theme plain

class BatchTranslationProcessor {
  -semaphore: Semaphore
  -batch_size: int
  -max_concurrent: int
  -retry_policy: Dict

  +process_batch_with_retry()
  +_execute_translation()
  +_handle_failure()
  +_apply_exponential_backoff()
}

class LLMProvider {
  <<interface>>
  +translate_batch()
  +validate_response()
}

class TranslationBatch {
  +batch_id: str
  +tasks: List[TranslationTask]
  +status: BatchStatus
  +retry_count: int
}

BatchTranslationProcessor --> LLMProvider
BatchTranslationProcessor --> TranslationBatch

note right of BatchTranslationProcessor
  é‡è¯•ç­–ç•¥:
  - æœ€å¤§é‡è¯•: 3æ¬¡
  - æŒ‡æ•°é€€é¿: 1.5^nç§’
  - è¶…æ—¶é€’å¢: 90s -> 600s
end note

@enduml
```

### 3. Excelåˆ†ææ¨¡å— (excel_analysis/)

#### ä»»åŠ¡æ£€æµ‹æœºåˆ¶

```plantuml
@startuml Task Detection
!theme plain

class TranslationDetector {
  +detect_translation_tasks()
  +group_tasks_by_batch()
  -_determine_task_type()
  -_get_source_text()
}

class ColorTaskDetector {
  +detect_color_tasks()
  -_is_yellow_color()
  -_is_blue_color()
  -_parse_rgb()
}

class TranslationTask {
  +row: int
  +column: str
  +source_text: str
  +target_text: str
  +task_type: TaskType
  +background_color: str
}

enum TaskType {
  NEW
  MODIFY
  SHORTEN
  COMPLETED
  SKIP
}

TranslationDetector --> TranslationTask
ColorTaskDetector --> TranslationTask
TranslationTask --> TaskType

note bottom of ColorTaskDetector
  é¢œè‰²è¯†åˆ«è§„åˆ™:
  é»„è‰²: R>200, G>200, B<100
  è“è‰²: B>150, B>R, B>G
  é’è“: R<50, G>100, B>150
end note

@enduml
```

### 4. ä»»åŠ¡ä»“åº“ (database/task_repository.py)

#### ç¼“å­˜ç®¡ç†ç­–ç•¥

```plantuml
@startuml Task Repository Cache
!theme plain

class TaskRepository {
  -_cache: OrderedDict
  -_dirty_tasks: Set
  -_max_cache_size: int
  -_flush_interval: int

  +get_task()
  +save_task()
  +update_task_progress()
  +update_task_status()
  +list_tasks()
  +flush_dirty_tasks()
  -_add_to_cache()
  -_load_from_db()
  -_save_to_db()
}

class MemoryCache {
  <<LRU Cache>>
  +size: 1000
  +eviction: LRU
}

class Database {
  <<MySQL>>
  +translation_tasks
  +batch_write()
}

TaskRepository --> MemoryCache : "Primary Storage"
TaskRepository --> Database : "Periodic Flush (5s)"

note right of TaskRepository
  ç¼“å­˜ç­–ç•¥:
  1. æ‰€æœ‰è¯»å†™ä¼˜å…ˆèµ°å†…å­˜
  2. è„æ•°æ®æ ‡è®°å¾…æŒä¹…åŒ–
  3. æ¯5ç§’æ‰¹é‡å†™å…¥æ•°æ®åº“
  4. LRUæ·˜æ±°æœ€å°‘ä½¿ç”¨é¡¹
  5. å…³é”®æ“ä½œç«‹å³æŒä¹…åŒ–
end note

@enduml
```

### 5. LLMæä¾›å•†é›†æˆ (llm_providers/)

#### LLMæŠ½è±¡å±‚

```plantuml
@startuml LLM Providers
!theme plain

abstract class BaseLLM {
  #provider: str
  #model: str
  #api_key: str
  #max_retries: int

  {abstract} +translate_batch()
  {abstract} +validate_config()
  +handle_rate_limit()
  +format_prompt()
}

class OpenAILLM {
  -client: OpenAI
  +translate_batch()
  +_call_api()
}

class QwenLLM {
  -client: OpenAI
  +translate_batch()
  +_call_api()
}

class DeepSeekLLM {
  -client: OpenAI
  +translate_batch()
  +_call_api()
}

class LLMFactory {
  {static} +create_llm()
  {static} +get_available_providers()
}

BaseLLM <|-- OpenAILLM
BaseLLM <|-- QwenLLM
BaseLLM <|-- DeepSeekLLM

LLMFactory --> BaseLLM : creates

note bottom of BaseLLM
  ç»Ÿä¸€çš„é”™è¯¯å¤„ç†:
  - APIé™æµé‡è¯•
  - ç¼–ç é”™è¯¯å¤„ç†
  - å“åº”éªŒè¯
  - æˆæœ¬ç»Ÿè®¡
end note

@enduml
```

---

## æ•°æ®æµç¨‹

### ç¿»è¯‘ä»»åŠ¡å®Œæ•´æµç¨‹

```plantuml
@startuml Translation Data Flow
!theme plain
skinparam sequenceMessageAlign center

actor User
participant "API Gateway" as API
participant "Task Repository" as TaskRepo
participant "Translation Engine" as Engine
participant "LLM Provider" as LLM
database "MySQL" as DB
cloud "OSS" as Storage

User -> API: POST /upload (Excelæ–‡ä»¶)
activate API

API -> TaskRepo: create_task()
activate TaskRepo
TaskRepo -> TaskRepo: ä¿å­˜åˆ°å†…å­˜ç¼“å­˜
TaskRepo --> API: task_id
deactivate TaskRepo

API -> Storage: ä¸Šä¼ åŸå§‹æ–‡ä»¶
API --> User: {task_id, status: "uploading"}
deactivate API

API -> Engine: process_translation_task()
activate Engine

Engine -> Engine: è§£æExcelç»“æ„
Engine -> Engine: æ£€æµ‹ç¿»è¯‘ä»»åŠ¡

loop è¿­ä»£ç¿»è¯‘ (æœ€å¤š5è½®)
    Engine -> Engine: æ£€æµ‹å‰©ä½™ä»»åŠ¡

    alt æœ‰å‰©ä½™ä»»åŠ¡
        Engine -> Engine: åˆ›å»ºæ‰¹æ¬¡

        loop å¹¶å‘å¤„ç†æ‰¹æ¬¡
            Engine -> LLM: translate_batch()
            activate LLM
            LLM --> Engine: ç¿»è¯‘ç»“æœ
            deactivate LLM
        end

        Engine -> TaskRepo: update_progress()
        activate TaskRepo
        TaskRepo -> TaskRepo: æ›´æ–°ç¼“å­˜
        TaskRepo -> TaskRepo: æ ‡è®°è„æ•°æ®
        deactivate TaskRepo
    else æ— å‰©ä½™ä»»åŠ¡
        Engine -> Engine: é€€å‡ºè¿­ä»£
    end
end

Engine -> Engine: ä¸‰é˜¶æ®µé¢œè‰²å¤„ç†
Engine -> Storage: ä¿å­˜ç»“æœæ–‡ä»¶

Engine -> TaskRepo: update_status("completed")
activate TaskRepo
TaskRepo -> DB: flush_dirty_tasks()
deactivate TaskRepo

deactivate Engine

User -> API: GET /tasks/{id}/progress
activate API
API -> TaskRepo: get_task()
activate TaskRepo
TaskRepo -> TaskRepo: ä»ç¼“å­˜è¯»å–
TaskRepo --> API: è¿›åº¦ä¿¡æ¯
deactivate TaskRepo
API --> User: {progress: 100%}
deactivate API

User -> API: GET /download/{id}
activate API
API -> Storage: è·å–ç»“æœæ–‡ä»¶
Storage --> API: Excelæ–‡ä»¶
API --> User: ä¸‹è½½æ–‡ä»¶
deactivate API

@enduml
```

---

## æ—¶åºå›¾

### æ‰¹å¤„ç†å¹¶å‘æ§åˆ¶æ—¶åº

```plantuml
@startuml Concurrent Batch Processing
!theme plain

participant "Engine" as E
participant "Semaphore" as S
participant "Batch 1" as B1
participant "Batch 2" as B2
participant "Batch 3" as B3
participant "LLM API" as LLM

E -> S: åˆ›å»ºä¿¡å·é‡(max=2)
E -> B1: å¯åŠ¨ä»»åŠ¡1
activate B1
B1 -> S: acquire()
S --> B1: è·å–æˆåŠŸ

E -> B2: å¯åŠ¨ä»»åŠ¡2
activate B2
B2 -> S: acquire()
S --> B2: è·å–æˆåŠŸ

E -> B3: å¯åŠ¨ä»»åŠ¡3
activate B3
B3 -> S: acquire()
S --> B3: ç­‰å¾…...

B1 -> LLM: ç¿»è¯‘è¯·æ±‚
LLM --> B1: å“åº”

B2 -> LLM: ç¿»è¯‘è¯·æ±‚
LLM --> B2: å“åº”

B1 -> S: release()
deactivate B1
S --> B3: è·å–æˆåŠŸ

B3 -> LLM: ç¿»è¯‘è¯·æ±‚
LLM --> B3: å“åº”

B2 -> S: release()
deactivate B2

B3 -> S: release()
deactivate B3

@enduml
```

### ç¼“å­˜åŒæ­¥æ—¶åº

```plantuml
@startuml Cache Synchronization
!theme plain

participant "API Request" as API
participant "Task Repository" as Repo
participant "Memory Cache" as Cache
participant "Dirty Set" as Dirty
participant "Flush Timer" as Timer
database "MySQL" as DB

API -> Repo: update_progress()
activate Repo
Repo -> Cache: æ›´æ–°ä»»åŠ¡æ•°æ®
Cache --> Repo: OK
Repo -> Dirty: add(task_id)
Dirty --> Repo: OK
Repo --> API: æˆåŠŸ
deactivate Repo

... 5ç§’å ...

Timer -> Repo: flush_dirty_tasks()
activate Repo
Repo -> Dirty: get_all()
Dirty --> Repo: [task_ids]

loop æ¯ä¸ªè„ä»»åŠ¡
    Repo -> Cache: get(task_id)
    Cache --> Repo: task_data
    Repo -> DB: save_to_db(task_data)
    DB --> Repo: OK
    Repo -> Dirty: remove(task_id)
end

Repo --> Timer: åˆ·æ–°å®Œæˆ
deactivate Repo

@enduml
```

---

## éƒ¨ç½²æ¶æ„

### Dockerå®¹å™¨åŒ–éƒ¨ç½²

```plantuml
@startuml Deployment Architecture
!theme plain

node "Docker Host" {

  component "Translation Backend" <<Container>> {
    [FastAPI App]
    [Task Repository]
    [Translation Engine]
  }

  component "Frontend" <<Container>> {
    [Vue3 App]
    [Nginx]
  }

  database "MySQL" <<Container>> {
    [Database Engine]
    [Data Volume]
  }

  component "Redis" <<Container>> {
    [Cache Store]
  }
}

cloud "Aliyun Services" {
  [RDS MySQL] as RDS
  [OSS Storage] as AliyunOSS
  [API Gateway] as AliyunAPI
}

cloud "LLM Services" {
  [OpenAI API]
  [é€šä¹‰åƒé—® API]
  [DeepSeek API]
}

[Translation Backend] --> RDS : æŒä¹…åŒ–
[Translation Backend] --> AliyunOSS : æ–‡ä»¶å­˜å‚¨
[Translation Backend] --> [OpenAI API] : ç¿»è¯‘è¯·æ±‚
[Translation Backend] --> [é€šä¹‰åƒé—® API] : ç¿»è¯‘è¯·æ±‚
[Translation Backend] --> [DeepSeek API] : ç¿»è¯‘è¯·æ±‚

[Frontend] --> [Translation Backend] : APIè°ƒç”¨
[Frontend] --> AliyunAPI : CDNåŠ é€Ÿ

@enduml
```

### ç³»ç»Ÿéƒ¨ç½²é…ç½®

```yaml
# docker-compose.yml ç¤ºä¾‹
version: '3.8'

services:
  backend:
    image: translation-backend:latest
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - OSS_ACCESS_KEY_ID=${OSS_ACCESS_KEY_ID}
      - OSS_ACCESS_KEY_SECRET=${OSS_ACCESS_KEY_SECRET}
    volumes:
      - ./logs:/app/logs
      - ./temp:/app/temp

  frontend:
    image: translation-frontend:latest
    ports:
      - "80:80"
    environment:
      - VITE_API_BASE_URL=http://backend:8000
```

---

## æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|---------|------|------|
| Webæ¡†æ¶ | FastAPI | 0.104+ | å¼‚æ­¥é«˜æ€§èƒ½Webæ¡†æ¶ |
| å¼‚æ­¥è¿è¡Œæ—¶ | Uvicorn | 0.24+ | ASGIæœåŠ¡å™¨ |
| æ•°æ®åº“ORM | SQLAlchemy | 2.0+ | å¼‚æ­¥ORMæ”¯æŒ |
| æ•°æ®åº“ | MySQL | 8.0+ | é˜¿é‡Œäº‘RDS |
| ç¼“å­˜ | å†…å­˜ç¼“å­˜ | - | OrderedDictå®ç°LRU |
| æ–‡ä»¶å¤„ç† | Pandas | 2.0+ | Excelæ–‡ä»¶å¤„ç† |
| | OpenPyXL | 3.1+ | Excelé¢œè‰²è¯†åˆ« |
| LLMé›†æˆ | OpenAI SDK | 1.0+ | LLM APIè°ƒç”¨ |
| å¯¹è±¡å­˜å‚¨ | Aliyun OSS | - | æ–‡ä»¶å­˜å‚¨ |
| æ—¥å¿— | Python Logging | - | ç»“æ„åŒ–æ—¥å¿— |

### å‰ç«¯æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|---------|------|------|
| æ¡†æ¶ | Vue3 | 3.3+ | ç»„åˆå¼API |
| æ„å»ºå·¥å…· | Vite | 5.0+ | å¿«é€Ÿæ„å»º |
| UIç»„ä»¶ | Element Plus | 2.4+ | ä¼ä¸šçº§ç»„ä»¶åº“ |
| çŠ¶æ€ç®¡ç† | Pinia | 2.1+ | Vue3çŠ¶æ€ç®¡ç† |
| HTTPå®¢æˆ·ç«¯ | Axios | 1.6+ | Promise HTTP |
| è·¯ç”± | Vue Router | 4.2+ | å•é¡µåº”ç”¨è·¯ç”± |

---

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. å¹¶å‘æ§åˆ¶
- **ä¿¡å·é‡é™åˆ¶**: é˜²æ­¢è¿‡å¤šå¹¶å‘è¯·æ±‚
- **åŠ¨æ€æ‰¹æ¬¡è°ƒæ•´**: æ ¹æ®æ–‡æœ¬é•¿åº¦å’Œå¤±è´¥ç‡è°ƒæ•´
- **è¶…æ—¶é€’å¢ç­–ç•¥**: é¿å…é•¿æ–‡æœ¬è¶…æ—¶

### 2. ç¼“å­˜ä¼˜åŒ–
- **LRUç¼“å­˜**: è‡ªåŠ¨æ·˜æ±°æœ€å°‘ä½¿ç”¨é¡¹
- **æ‰¹é‡æŒä¹…åŒ–**: å‡å°‘æ•°æ®åº“å†™å…¥é¢‘ç‡
- **å†…å­˜ä¼˜å…ˆ**: æŸ¥è¯¢ç›´æ¥è¯»å–å†…å­˜ç¼“å­˜

### 3. é”™è¯¯å¤„ç†
- **æŒ‡æ•°é€€é¿é‡è¯•**: 1.5^nç§’é—´éš”
- **éƒ¨åˆ†å¤±è´¥å®¹é”™**: å•æ‰¹æ¬¡å¤±è´¥ä¸å½±å“æ•´ä½“
- **ä¼˜é›…é™çº§**: LLMæœåŠ¡ä¸å¯ç”¨æ—¶çš„å¤„ç†

### 4. èµ„æºç®¡ç†
- **è¿æ¥æ± å¤ç”¨**: æ•°æ®åº“å’ŒHTTPè¿æ¥æ± 
- **å¼‚æ­¥IO**: å……åˆ†åˆ©ç”¨å¼‚æ­¥ç‰¹æ€§
- **æµå¼å¤„ç†**: å¤§æ–‡ä»¶åˆ†ç‰‡å¤„ç†

---

## ç›‘æ§ä¸è¿ç»´

### å…³é”®æŒ‡æ ‡ç›‘æ§

```plantuml
@startuml Monitoring Metrics
!theme plain

class MetricsCollector {
  +task_count: Counter
  +translation_duration: Histogram
  +api_calls: Counter
  +cache_hit_rate: Gauge
  +error_rate: Counter

  +collect_metrics()
  +export_prometheus()
}

class HealthCheck {
  +database_health()
  +cache_health()
  +llm_service_health()
  +storage_health()
}

class AlertManager {
  +high_error_rate()
  +slow_translation()
  +cache_miss_spike()
  +database_connection_loss()
}

MetricsCollector --> HealthCheck
HealthCheck --> AlertManager

@enduml
```

### æ—¥å¿—ä½“ç³»

```
æ—¥å¿—çº§åˆ«:
- ERROR: ç³»ç»Ÿé”™è¯¯ã€APIè°ƒç”¨å¤±è´¥
- WARNING: é‡è¯•ã€é™çº§ã€æ€§èƒ½é—®é¢˜
- INFO: ä»»åŠ¡çŠ¶æ€å˜æ›´ã€å…³é”®æ“ä½œ
- DEBUG: è¯¦ç»†æ‰§è¡Œè¿‡ç¨‹ã€æ•°æ®å˜åŒ–
```

---

## æœªæ¥æ‰©å±•

### è®¡åˆ’ä¸­çš„åŠŸèƒ½
1. **WebSocketå®æ—¶æ¨é€**: å®æ—¶è¿›åº¦æ›´æ–°
2. **æœ¯è¯­åº“ç®¡ç†**: æ¸¸æˆä¸“ç”¨æœ¯è¯­ç»Ÿä¸€ç®¡ç†
3. **è´¨é‡è¯„åˆ†ç³»ç»Ÿ**: ç¿»è¯‘è´¨é‡è‡ªåŠ¨è¯„åˆ†
4. **å¤šæ¨¡å‹å¯¹æ¯”**: å¤šä¸ªLLMæ¨¡å‹ç»“æœå¯¹æ¯”
5. **å¢é‡ç¿»è¯‘ä¼˜åŒ–**: åŸºäºGitçš„å¢é‡æ£€æµ‹
6. **åˆ†å¸ƒå¼å¤„ç†**: å¤šèŠ‚ç‚¹åˆ†å¸ƒå¼ç¿»è¯‘

### æ¶æ„æ¼”è¿›æ–¹å‘
- å¾®æœåŠ¡åŒ–æ‹†åˆ†
- äº‹ä»¶é©±åŠ¨æ¶æ„
- CQRSè¯»å†™åˆ†ç¦»
- å®¹å™¨ç¼–æ’(K8s)

---

## æ€»ç»“

æœ¬ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œé€šè¿‡ç»Ÿä¸€çš„ç¼“å­˜ç®¡ç†ã€æ™ºèƒ½çš„ä»»åŠ¡æ£€æµ‹ã€é«˜æ•ˆçš„æ‰¹å¤„ç†æœºåˆ¶ï¼Œå®ç°äº†æ¸¸æˆæ–‡æœ¬çš„è‡ªåŠ¨åŒ–ç¿»è¯‘ã€‚ç³»ç»Ÿå…·æœ‰è‰¯å¥½çš„æ‰©å±•æ€§å’Œç»´æŠ¤æ€§ï¼Œèƒ½å¤Ÿæ»¡è¶³å¤§è§„æ¨¡æ¸¸æˆæœ¬åœ°åŒ–çš„éœ€æ±‚ã€‚

æ ¸å¿ƒä¼˜åŠ¿:
- âœ… é«˜æ€§èƒ½å¹¶å‘å¤„ç†
- âœ… æ™ºèƒ½ä»»åŠ¡è¯†åˆ«
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†
- âœ… çµæ´»çš„LLMé›†æˆ
- âœ… å®æ—¶è¿›åº¦ç›‘æ§
- âœ… ä¼ä¸šçº§å¯é æ€§

---

*æœ¬æ–‡æ¡£å°†éšç³»ç»Ÿæ¼”è¿›æŒç»­æ›´æ–°*