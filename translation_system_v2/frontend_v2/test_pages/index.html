<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>独立模块测试 - 导航页</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            text-align: center;
        }
        .header h1 {
            color: #667eea;
            margin: 0 0 15px 0;
            font-size: 32px;
        }
        .header p {
            color: #666;
            margin: 8px 0;
            font-size: 15px;
        }
        .principle {
            background: #e7f3ff;
            padding: 20px;
            border-left: 4px solid #667eea;
            border-radius: 6px;
            margin-top: 15px;
            text-align: left;
        }
        .stages-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .stage-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        .stage-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        .stage-card.stage1 {
            border-top: 4px solid #667eea;
        }
        .stage-card.stage2 {
            border-top: 4px solid #ff6b6b;
        }
        .stage-card.stage3 {
            border-top: 4px solid #f5576c;
        }
        .stage-card.stage4 {
            border-top: 4px solid #4facfe;
        }
        .stage-title {
            font-size: 22px;
            font-weight: bold;
            margin: 0 0 10px 0;
        }
        .stage1 .stage-title { color: #667eea; }
        .stage2 .stage-title { color: #ff6b6b; }
        .stage3 .stage-title { color: #f5576c; }
        .stage4 .stage-title { color: #4facfe; }
        .stage-desc {
            color: #666;
            margin: 10px 0;
            line-height: 1.6;
        }
        .stage-flow {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 13px;
        }
        .stage-btn {
            display: block;
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            text-align: center;
            border-radius: 6px;
            font-weight: bold;
            margin-top: 15px;
            transition: transform 0.2s;
        }
        .stage1 .stage-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .stage2 .stage-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
        }
        .stage3 .stage-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        .stage4 .stage-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        .stage-btn:hover {
            transform: translateY(-2px);
        }
        .architecture-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .architecture-section h2 {
            color: #667eea;
            margin-top: 0;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        .workflow-diagram {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            font-family: monospace;
            line-height: 1.8;
            margin: 15px 0;
            border-left: 4px solid #28a745;
        }
        .chaining-diagram {
            background: #fff9e6;
            padding: 20px;
            border-radius: 8px;
            font-family: monospace;
            line-height: 1.8;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
        }
        .key-points {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .key-points ul {
            margin: 10px 0;
            padding-left: 25px;
        }
        .key-points li {
            margin: 8px 0;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🧪 独立模块测试 - 导航页</h1>
        <p><strong>测试理念</strong>: 每个模块完全独立，通过Session ID链接</p>
        <p><strong>架构遵循</strong>: ARCHITECTURE_PRINCIPLES.md</p>

        <div class="principle">
            <strong>💡 核心架构原则</strong>:<br><br>
            <strong>数据状态N → [拆分器] → 任务表 → [转换器] → 数据状态N+1</strong><br><br>
            • <strong>数据状态连续性</strong>: 原始数据 = 结果数据 = 数据状态（无区别）<br>
            • <strong>任务表唯一中间数据</strong>: TaskDataFrame描述如何从状态N变成状态N+1<br>
            • <strong>无限链式支持</strong>: 任何输出状态都可以作为下一个转换的输入<br>
            • <strong>拆分器与转换器分离</strong>: 任务拆分和执行转换完全独立
        </div>
    </div>

    <div class="stages-container">
        <div class="stage-card stage1" onclick="location.href='1_upload_and_split.html'">
            <div class="stage-title">🎯 阶段1: 上传文件 + 任务拆分</div>
            <div class="stage-desc">
                <strong>架构阶段</strong>: CREATED → INPUT_LOADED → SPLIT_COMPLETE
            </div>
            <div class="stage-flow">
输入: Excel文件（数据状态0）
处理: 拆分器生成任务表
输出: Session ID（包含任务表）
            </div>
            <div class="stage-desc">
                <strong>测试内容</strong>:<br>
                • 上传Excel文件并加载为数据状态0<br>
                • 根据rule_set拆分任务（translation/caps_only）<br>
                • 提取上下文信息<br>
                • 生成任务表（描述转换指令）
            </div>
            <a href="1_upload_and_split.html" class="stage-btn">进入阶段1 →</a>
        </div>

        <div class="stage-card stage2" onclick="location.href='2_execute_transformation.html'">
            <div class="stage-title">⚡ 阶段2: 执行转换</div>
            <div class="stage-desc">
                <strong>架构阶段</strong>: SPLIT_COMPLETE → EXECUTING → COMPLETED
            </div>
            <div class="stage-flow">
输入: Session ID（包含任务表）
处理: 转换器执行任务
输出: Session ID（数据状态1）
            </div>
            <div class="stage-desc">
                <strong>测试内容</strong>:<br>
                • 从阶段1获取Session ID<br>
                • 自动选择或手动指定Processor<br>
                • 执行转换（llm_qwen翻译/uppercase大写）<br>
                • 实时监控进度并生成数据状态1
            </div>
            <a href="2_execute_transformation.html" class="stage-btn">进入阶段2 →</a>
        </div>

        <div class="stage-card stage3" onclick="location.href='3_download_results.html'">
            <div class="stage-title">📥 阶段3: 下载结果</div>
            <div class="stage-desc">
                <strong>架构阶段</strong>: COMPLETED → 导出Excel文件
            </div>
            <div class="stage-flow">
输入: Session ID（数据状态N）
处理: 导出器生成Excel
输出: Excel文件（物理文件）
            </div>
            <div class="stage-desc">
                <strong>测试内容</strong>:<br>
                • 从阶段2获取完成的Session ID<br>
                • 检查Session状态和统计信息<br>
                • 导出Excel文件（保留格式、颜色、批注）<br>
                • 文件可作为新的数据状态0
            </div>
            <a href="3_download_results.html" class="stage-btn">进入阶段3 →</a>
        </div>

        <div class="stage-card stage4" onclick="location.href='4_caps_transformation.html'">
            <div class="stage-title">🔤 阶段4: CAPS大写转换（链式）</div>
            <div class="stage-desc">
                <strong>架构阶段</strong>: 数据状态1 → 数据状态2（第二次转换）
            </div>
            <div class="stage-flow">
输入: Parent Session ID（数据状态1）
处理: 创建子Session → 拆分CAPS任务 → 执行大写转换
输出: New Session ID（数据状态2）
            </div>
            <div class="stage-desc">
                <strong>测试内容</strong>:<br>
                • 从阶段2获取Parent Session ID<br>
                • 创建子Session并继承数据状态1<br>
                • 拆分CAPS任务（rule_set=caps_only）<br>
                • 执行大写转换，演示无限链式能力
            </div>
            <a href="4_caps_transformation.html" class="stage-btn">进入阶段4 →</a>
        </div>
    </div>

    <div class="architecture-section">
        <h2>📐 完整工作流程</h2>

        <div class="workflow-diagram">
<strong>基础工作流（阶段1→2→3）</strong>:

┌─────────────────────────────────────────────────────────────┐
│ 阶段1: 上传 + 拆分                                          │
├─────────────────────────────────────────────────────────────┤
│ Excel文件 → [拆分器] → 任务表                               │
│ (数据状态0)             (描述如何转换)                       │
│ 输出: Session ID (stage=SPLIT_COMPLETE)                     │
└─────────────────────────────────────────────────────────────┘
                    ↓ (通过Session ID连接)
┌─────────────────────────────────────────────────────────────┐
│ 阶段2: 执行转换                                             │
├─────────────────────────────────────────────────────────────┤
│ 任务表 → [转换器] → 数据状态1                               │
│          (llm_qwen/uppercase)                               │
│ 输出: Session ID (stage=COMPLETED)                          │
└─────────────────────────────────────────────────────────────┘
                    ↓ (通过Session ID连接)
┌─────────────────────────────────────────────────────────────┐
│ 阶段3: 下载结果                                             │
├─────────────────────────────────────────────────────────────┤
│ 数据状态1 → [导出器] → Excel文件                            │
│                        (物理文件)                           │
│ 输出: 下载的Excel文件                                       │
└─────────────────────────────────────────────────────────────┘
        </div>

        <div class="chaining-diagram">
<strong>链式工作流（阶段1→2→4→3）</strong>:

阶段1: Excel → Session1 (数据状态0 → 任务表1 → 数据状态1)
                  ↓
阶段2: Session1执行翻译 (stage=COMPLETED)
                  ↓ (作为parent_session_id)
阶段4: Session2继承 (数据状态1 → 任务表2 → 数据状态2)
       • 创建子Session
       • 继承数据状态1
       • 拆分CAPS任务
       • 执行大写转换
                  ↓
阶段3: 下载Session2 (获得: 翻译 + 大写 的结果)

<strong>🔗 无限链式能力</strong>:
Session1 → Session2 → Session3 → Session4 → ...
状态0  →  状态1  →  状态2  →  状态3  → ...
        </div>

        <div class="key-points">
            <strong>🎯 关键测试要点</strong>:
            <ul>
                <li><strong>完全独立</strong>: 每个阶段可以单独测试，互不依赖</li>
                <li><strong>Session ID连接</strong>: 阶段间唯一的连接方式是Session ID（手动复制粘贴）</li>
                <li><strong>状态机严格</strong>: 每个阶段检查前置状态（如阶段2要求SPLIT_COMPLETE）</li>
                <li><strong>拆分与转换分离</strong>: 阶段1只拆分，阶段2只执行，职责清晰</li>
                <li><strong>规则可配置</strong>: rule_set决定任务类型，processor决定转换方式</li>
                <li><strong>无限链式</strong>: 阶段4演示如何进行第二次、第三次...转换</li>
                <li><strong>数据连续性</strong>: 任何输出状态都可以作为下一个转换的输入</li>
            </ul>
        </div>
    </div>

    <div class="architecture-section">
        <h2>🔬 测试建议</h2>

        <div class="key-points">
            <strong>测试场景1: 基础翻译流程</strong>
            <ul>
                <li>1. 阶段1: 上传Excel，rule_set=translation → 获得Session ID</li>
                <li>2. 阶段2: 使用Session ID，processor=llm_qwen → 完成翻译</li>
                <li>3. 阶段3: 使用Session ID → 下载翻译结果</li>
            </ul>
        </div>

        <div class="key-points">
            <strong>测试场景2: 链式转换（翻译 + 大写）</strong>
            <ul>
                <li>1. 阶段1: 上传Excel，rule_set=translation → Session1</li>
                <li>2. 阶段2: 执行翻译 → Session1 (completed)</li>
                <li>3. 阶段4: parent_session_id=Session1 → 创建Session2并执行大写</li>
                <li>4. 阶段3: 下载Session2 → 获得翻译+大写的结果</li>
            </ul>
        </div>

        <div class="key-points">
            <strong>测试场景3: 仅CAPS大写</strong>
            <ul>
                <li>1. 阶段1: 上传Excel，rule_set=caps_only → Session ID</li>
                <li>2. 阶段2: processor=uppercase → 完成大写转换</li>
                <li>3. 阶段3: 下载结果</li>
            </ul>
        </div>

        <div class="key-points">
            <strong>独立性验证</strong>
            <ul>
                <li>✅ 可以只运行阶段1，检查任务拆分结果</li>
                <li>✅ 可以只运行阶段2（使用历史Session ID）</li>
                <li>✅ 可以只运行阶段3（下载历史Session）</li>
                <li>✅ 可以跳过阶段4（不需要链式转换时）</li>
                <li>✅ 每个阶段失败不影响其他阶段</li>
            </ul>
        </div>
    </div>

    <div class="architecture-section" style="text-align: center; padding: 20px;">
        <p style="color: #666; margin: 10px 0;">
            <strong>架构参考文档</strong>:
            <code>/mnt/d/work/trans_excel/translation_system_v2/.claude/ARCHITECTURE_PRINCIPLES.md</code>
        </p>
        <p style="color: #999; font-size: 13px; margin-top: 15px;">
            🧪 这些测试页面完全遵循架构原则，每个模块独立可测试
        </p>
    </div>
</body>
</html>
