# ⚡ n8n 工作流快速使用指南

## 📋 前提条件

1. ✅ **Backend_v2 已运行**（独立项目，在 `localhost:8013`）
   - 这是独立的项目，请参考 backend_v2 自己的文档启动
   - 验证：`curl http://localhost:8013/health`

2. ✅ **Docker 已安装**
   - 用于运行 n8n 容器

---

## 🚀 两步启动（仅 n8n 部分）

### 步骤1: 启动 n8n 容器

```bash
cd /mnt/d/work/trans_excel/translation_system_v2/integrations/n8n/docker
docker-compose up -d
```

验证：
```bash
curl http://localhost:5678/healthz
```

### 步骤2: 自动创建工作流

```bash
cd /mnt/d/work/trans_excel/translation_system_v2/integrations/n8n/scripts
python3 auto_create_via_api.py
```

**脚本会输出表单 URL**，例如：
```
📋 表单访问地址:
   http://localhost:5678/form/abc-def-123-456
```

---

## 💡 使用表单

1. **访问表单 URL**（从步骤2的输出中复制）
2. **上传 Excel 文件**
3. **选择目标语言**（英文/泰文/日文/韩文）
4. **输入术语库**（可选，默认 default）
5. **提交**

返回示例：
```json
{
  "success": true,
  "session_id": "abc-123",
  "status_url": "http://localhost:8013/api/tasks/split/status/abc-123",
  "download_url": "http://localhost:8013/api/download/abc-123"
}
```

---

## 🔄 重新创建工作流

如果需要修改工作流配置：

1. **编辑脚本**:
   ```bash
   vim scripts/auto_create_via_api.py
   ```

2. **修改 `WORKFLOW_DEFINITION`**（例如添加语言选项）

3. **重新运行**:
   ```bash
   python3 scripts/auto_create_via_api.py
   ```

脚本会自动删除旧工作流并创建新的。

---

## 🛑 停止服务

```bash
cd /mnt/d/work/trans_excel/translation_system_v2/integrations/n8n/docker
docker-compose down
```

---

## 📚 详细文档

- **API自动创建工作流方案.md** - 完整技术文档
- **终极自动化方案总结.md** - 方案总结
- **README.md** - 完整说明

---

## 🐛 常见问题

### Q: Backend 连接失败

**确保 backend_v2 已启动**（这是独立项目）：
```bash
curl http://localhost:8013/health
```

如果未启动，请参考 backend_v2 项目的文档。

### Q: 表单无法访问

重新运行自动创建脚本：
```bash
python3 scripts/auto_create_via_api.py
```

---

## ⚠️ 重要说明

- ✅ **本项目只负责 n8n 工作流**
- ✅ **Backend_v2 是独立项目**，有自己的启动方式
- ✅ **不要混淆两个项目的管理**
- ✅ **确保 backend 在 8013 端口运行后再启动 n8n**
