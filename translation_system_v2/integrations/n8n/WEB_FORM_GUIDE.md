# Web 表单翻译使用指南

本指南说明如何使用 n8n Web 表单进行 Excel 文件翻译。

---

## 🎯 核心优势

**零学习成本**:
- ✅ 打开浏览器即可使用
- ✅ 不需要命令行
- ✅ 不需要配置工作流
- ✅ 不需要了解 n8n

**一键翻译**:
```
上传文件 → 选择语言 → 点击提交 → 自动翻译 → 下载结果
```

---

## 🚀 快速开始（3步）

### 步骤1: 部署系统

```bash
# 进入 n8n 目录
cd /mnt/d/work/trans_excel/translation_system_v2/integrations/n8n

# 一键部署
./scripts/setup.sh
```

等待部署完成（约1-2分钟）。

---

### 步骤2: 访问 Web 表单

打开浏览器访问: **http://localhost:5678/form/translate**

你会看到一个友好的表单界面：

```
┌─────────────────────────────────────────────────┐
│  📄 Excel 文件翻译系统                          │
│  上传 Excel 文件，自动翻译为多种语言            │
├─────────────────────────────────────────────────┤
│                                                 │
│  Excel 文件 *                                   │
│  [选择文件]                                     │
│                                                 │
│  目标语言 *                                     │
│  ☑ 英文 (EN)                                   │
│  ☐ 泰文 (TH)                                   │
│  ☐ 葡萄牙文 (PT)                               │
│  ☐ 越南文 (VN)                                 │
│                                                 │
│  术语表                                         │
│  [下拉选择] 游戏术语 (game_terms)              │
│                                                 │
│  翻译引擎                                       │
│  [下拉选择] 通义千问 (推荐)                    │
│                                                 │
│  [提交]                                         │
└─────────────────────────────────────────────────┘
```

---

### 步骤3: 填写表单并提交

1. **上传文件**: 点击"选择文件"，选择你的 Excel 文件
2. **选择语言**: 勾选一个或多个目标语言
3. **选择术语表**（可选）: 选择预设的术语表
4. **选择引擎**（可选）: 默认使用通义千问
5. **点击提交**: 等待翻译完成

---

## 📋 表单字段说明

### 1. Excel 文件 *（必填）

**支持格式**:
- `.xlsx` (推荐)
- `.xls`

**文件大小**: 建议 < 10MB

**注意事项**:
- 必须包含标准的数据结构
- 支持多个 Sheet
- 支持颜色标记（黄色/蓝色）

---

### 2. 目标语言 *（必填，可多选）

| 语言 | 代码 | 说明 |
|-----|------|------|
| 英文 | EN | 英语翻译 |
| 泰文 | TH | 泰语翻译 |
| 葡萄牙文 | PT | 葡萄牙语翻译 |
| 越南文 | VN | 越南语翻译 |

**多选示例**:
```
☑ 英文 (EN)
☑ 泰文 (TH)
☐ 葡萄牙文 (PT)
☐ 越南文 (VN)
```
→ 将翻译为英文和泰文

---

### 3. 术语表（可选）

**预设术语表**:

| 术语表 | ID | 术语数 | 适用场景 |
|-------|----|----|---------|
| 游戏术语 | game_terms | 12+ | 游戏文本翻译 |
| 商业术语 | business_terms | 15+ | 商业文档翻译 |
| 技术术语 | technical_terms | 18+ | 技术文档翻译 |

**术语表作用**:
- ✅ 确保专业术语翻译一致
- ✅ 提升翻译质量
- ✅ 避免术语混乱

**示例**:
```
不使用术语表:
  "攻击力" → "Attack Power"

使用游戏术语表:
  "攻击力" → "ATK" ✅
```

---

### 4. 翻译引擎（可选）

| 引擎 | 说明 | 推荐场景 |
|-----|------|---------|
| 通义千问 (推荐) | llm_qwen | 中文翻译效果好，速度快 |
| OpenAI GPT | llm_openai | 英文翻译效果好，成本较高 |

**默认**: 通义千问

---

## 🎬 使用示例

### 示例1: 简单翻译（仅翻译为英文）

```
1. 上传文件: game.xlsx
2. 目标语言: ☑ 英文 (EN)
3. 术语表: 不使用
4. 翻译引擎: 通义千问 (推荐)
5. 点击 [提交]
```

**预计时间**: 1-5分钟（取决于文件大小）

---

### 示例2: 多语言翻译 + 术语表

```
1. 上传文件: game_skills.xlsx
2. 目标语言: ☑ 英文 (EN) + ☑ 泰文 (TH)
3. 术语表: 游戏术语 (game_terms)
4. 翻译引擎: 通义千问 (推荐)
5. 点击 [提交]
```

**效果**:
- 翻译为英文和泰文
- 术语（如"攻击力"）统一翻译为 "ATK"
- 确保多语言术语一致性

---

### 示例3: 商业文档翻译

```
1. 上传文件: invoice_template.xlsx
2. 目标语言: ☑ 英文 (EN)
3. 术语表: 商业术语 (business_terms)
4. 翻译引擎: 通义千问 (推荐)
5. 点击 [提交]
```

**效果**:
- "订单" → "Order"
- "发票" → "Invoice"
- "客户" → "Customer"

---

## ⏱️ 翻译时间估算

| 文件大小 | 行数 | 语言数 | 预计时间 |
|---------|-----|--------|---------|
| 小文件 | < 100行 | 1个 | 1-2分钟 |
| 中文件 | 100-500行 | 1个 | 3-5分钟 |
| 大文件 | 500-1000行 | 1个 | 5-10分钟 |
| 多语言 | 500行 | 3个 | 10-15分钟 |

---

## 📥 获取结果

### 提交后页面

```
┌─────────────────────────────────────────────────┐
│  ✅ 翻译任务已提交！                            │
│                                                 │
│  正在处理您的文件，请稍等片刻...                │
│                                                 │
│  您可以关闭此页面，稍后通过 Session ID 查询结果 │
│                                                 │
│  Session ID: abc-123-def-456                    │
└─────────────────────────────────────────────────┘
```

---

### 方式1: 通过 API 下载

```bash
# 使用返回的 Session ID
curl http://localhost:8013/api/download/abc-123-def-456 -o result.xlsx
```

---

### 方式2: 查看文件系统

如果启用了文件保存，结果会保存到:
```
/data/output/your_file_translated.xlsx
```

---

### 方式3: n8n 执行历史

1. 访问 **http://localhost:5678**
2. 点击左侧 **"Executions"**
3. 找到对应的执行记录
4. 查看 "Download Result" 节点的输出

---

## 🔍 查看进度

### n8n 执行页面

1. 访问 **http://localhost:5678**
2. 点击 **"Executions"**
3. 查看最新的执行记录
4. 可以看到每个节点的状态:
   ```
   ✅ Translation Form
   ✅ Process Form Data
   ✅ Upload & Split Tasks
   ⏳ Poll Split Status (运行中)
   ⏸️  Execute Translation (等待)
   ⏸️  Poll Execution Status (等待)
   ⏸️  Download Result (等待)
   ```

---

## ❓ 常见问题

### Q1: 提交后没有反应？

**可能原因**:
1. 后端 API 未运行
2. 文件格式不支持
3. 网络连接问题

**解决方法**:
```bash
# 检查后端状态
curl http://localhost:8013/api/database/health

# 查看日志
cd docker && docker-compose logs -f backend
```

---

### Q2: 翻译时间很长？

**原因**: 文件较大或选择了多个目标语言

**建议**:
- 拆分大文件
- 分批次翻译不同语言
- 增加并发数（需修改工作流参数）

---

### Q3: 如何查看翻译错误？

**方法1**: 查看 n8n 执行历史
```
http://localhost:5678 → Executions → 点击失败的执行
```

**方法2**: 查看后端日志
```bash
cd docker && docker-compose logs -f backend
```

---

### Q4: 术语表不生效？

**检查**:
1. 术语表是否已上传到后端
   ```bash
   curl http://localhost:8013/api/glossaries/list
   ```

2. 表单中是否选择了术语表

3. 术语表中的术语是否与原文完全匹配

---

### Q5: 如何自定义表单？

**修改工作流**:
1. 访问 **http://localhost:5678**
2. 打开工作流 "Web Form Translation"
3. 双击 "Translation Form" 节点
4. 修改表单字段
5. 保存并激活

---

## 🎨 自定义术语表

### 创建新术语表

1. **创建 JSON 文件**:
   ```json
   {
     "自定义术语1": "Custom Term 1",
     "自定义术语2": "Custom Term 2"
   }
   ```

2. **上传到后端**:
   ```bash
   curl -X POST http://localhost:8013/api/glossaries/upload \
     -F "file=@my_terms.json" \
     -F "glossary_id=my_terms"
   ```

3. **在表单中选择**:
   - 刷新页面
   - 术语表下拉菜单会出现新选项

---

## 🔧 高级配置

### 修改并发数

编辑工作流中的 "Execute Translation" 节点:
```json
{
  "max_workers": 10  // 改为 20 可加快速度
}
```

### 修改轮询间隔

编辑 "Wait 2s" 和 "Wait 5s" 节点:
```json
{
  "amount": 2,  // 改为 1 可更频繁检查状态
  "unit": "seconds"
}
```

### 添加新语言

编辑 "Translation Form" 节点的目标语言字段:
```json
{
  "fieldOptions": {
    "values": [
      {"option": "英文 (EN)", "value": "EN"},
      {"option": "新语言", "value": "NEW_LANG"}  // 添加这行
    ]
  }
}
```

---

## 📚 相关文档

- [快速开始](./README.md) - 5分钟上手指南
- [工作流目录](./docs/WORKFLOW_CATALOG.md) - 所有工作流说明
- [Docker部署](./docs/DOCKER_DEPLOYMENT.md) - 生产环境部署
- [后端API](../../backend_v2/API_REFERENCE.md) - API完整文档

---

## 🆘 获取帮助

### 查看日志

```bash
# n8n 日志
docker-compose logs -f n8n

# 后端日志
docker-compose logs -f backend

# 所有日志
docker-compose logs -f
```

### 重启服务

```bash
cd docker
docker-compose restart
```

### 重新部署

```bash
cd docker
docker-compose down
./scripts/setup.sh
```

---

## 🎉 总结

**Web 表单翻译的优势**:

1. **零学习成本** - 打开浏览器即可使用
2. **可视化操作** - 友好的表单界面
3. **自动化处理** - 提交后自动完成所有步骤
4. **灵活配置** - 支持多语言、术语表、引擎选择
5. **开箱即用** - 一键部署，立即使用

**适合人群**:
- ✅ 非技术人员
- ✅ 偶尔使用翻译功能
- ✅ 不熟悉命令行
- ✅ 需要快速翻译

**不适合场景**:
- ❌ 大批量自动化处理（建议用命令行或定时任务）
- ❌ 需要高度自定义流程（建议直接修改工作流）

---

**开始使用**: http://localhost:5678/form/translate 🚀
