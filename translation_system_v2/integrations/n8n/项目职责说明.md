# 📋 项目职责说明

## 🎯 本项目（n8n 集成）职责范围

### ✅ 负责内容

1. **n8n 容器管理**
   - n8n Docker 容器的启动/停止
   - n8n 配置（.env、docker-compose.yml）
   - n8n 数据持久化

2. **工作流自动创建**
   - 通过 n8n REST API 创建工作流
   - 工作流的配置和管理
   - Form Trigger 表单生成

3. **n8n 相关脚本**
   - `auto_create_via_api.py` - 自动创建工作流
   - 其他 n8n 管理脚本

4. **n8n 文档**
   - API 使用文档
   - 工作流配置说明
   - 故障排查指南

### ❌ 不负责内容

1. **Backend_v2 项目**
   - Backend 的启动/停止
   - Backend 的配置管理
   - Backend 的依赖安装
   - Backend 的端口管理（8013）

2. **Backend 相关操作**
   - 不检查 Backend 依赖
   - 不启动 Backend 服务
   - 不管理 Backend 进程

---

## 🏗️ 项目关系

```
┌─────────────────────────────────┐
│   Backend_v2（独立项目）         │
│   - 独立启动和管理               │
│   - 端口: 8013                  │
│   - 有自己的文档和脚本           │
└────────────┬────────────────────┘
             │ HTTP API
             │
┌────────────▼────────────────────┐
│   n8n 集成（本项目）             │
│   - 仅管理 n8n 容器              │
│   - 通过 API 调用 Backend        │
│   - 端口: 5678                  │
└─────────────────────────────────┘
```

---

## 📝 使用流程

### 正确的启动顺序

1. **用户负责**: 启动 Backend_v2
   - 参考 `backend_v2/README.md`
   - 验证: `curl http://localhost:8013/health`

2. **本项目负责**: 启动 n8n
   ```bash
   cd integrations/n8n/docker
   docker-compose up -d
   ```

3. **本项目负责**: 创建工作流
   ```bash
   cd integrations/n8n/scripts
   python3 auto_create_via_api.py
   ```

---

## ⚠️ 常见误区

### ❌ 错误做法

1. **在 n8n 项目中启动 Backend**
   - ❌ 不应该：`./scripts/start_all.sh`（包含 backend 启动）
   - ❌ 不应该：在 docker-compose.yml 中构建 backend

2. **在 n8n 项目中管理 Backend 配置**
   - ❌ 不应该：修改 Backend 的 .env
   - ❌ 不应该：检查 Backend 依赖

3. **混淆两个项目的端口**
   - ❌ 不应该：在 n8n 项目中占用 8013 端口
   - ❌ 不应该：在 Backend 项目中占用 5678 端口

### ✅ 正确做法

1. **Backend 和 n8n 分别管理**
   - ✅ Backend: 参考 `backend_v2/README.md`
   - ✅ n8n: 参考 `integrations/n8n/README.md`

2. **只验证服务可用性**
   - ✅ n8n 脚本可以检查 Backend 是否可访问
   - ✅ 但不负责启动 Backend

3. **清晰的依赖关系**
   - ✅ n8n 依赖 Backend API
   - ✅ 但不管理 Backend 生命周期

---

## 📚 文档索引

### Backend_v2 项目文档
- `/backend_v2/README.md` - Backend 启动和使用
- `/backend_v2/API_REFERENCE.md` - API 文档
- `/backend_v2/DOCKER_QUICKSTART.md` - Docker 部署

### n8n 集成项目文档（本项目）
- `README.md` - 快速开始
- `快速使用指南.md` - 简化使用说明
- `API自动创建工作流方案.md` - 技术详解
- `终极自动化方案总结.md` - 方案总结

---

## 🔧 技术细节

### n8n 如何调用 Backend

n8n 工作流中的 HTTP Request 节点配置：
```python
{
    "url": "http://backend:8013/api/tasks/split",
    # 或者使用 host.docker.internal (Docker Desktop)
    "url": "http://host.docker.internal:8013/api/tasks/split"
}
```

### 网络通信

- **Backend**: 运行在宿主机 `localhost:8013`
- **n8n**: 运行在 Docker 容器中
- **通信方式**: n8n 通过 `host.docker.internal` 访问宿主机的 Backend

---

## 🆘 故障排查

### 问题: Backend 连接失败

**现象**: n8n 工作流调用 Backend API 失败

**排查步骤**:

1. **检查 Backend 是否运行**（用户责任）
   ```bash
   curl http://localhost:8013/health
   ```

2. **检查网络配置**（n8n 项目责任）
   - 确认 n8n 使用正确的 URL
   - 测试: `docker exec translation_n8n curl http://host.docker.internal:8013/health`

3. **查看日志**
   - Backend 日志: 参考 Backend 项目文档
   - n8n 日志: `docker logs translation_n8n`

---

## ✨ 总结

| 项目 | 职责 | 端口 | 启动方式 |
|-----|------|------|---------|
| **Backend_v2** | 翻译 API 服务 | 8013 | 参考其自己的文档 |
| **n8n 集成** | 工作流自动化 | 5678 | `docker-compose up -d` |

**关键原则**:
- ✅ 各自管理各自的项目
- ✅ 通过 API 进行集成
- ✅ 不越界管理其他项目
